# 活动订单系统使用指南

## 📋 系统概述

活动订单系统是一个完整的商品化活动管理和订单处理系统，支持活动分类、订单状态管理、用户下单、管理员处理订单等全流程功能。

---

## 🎯 核心功能

### 1. 活动分类管理（管理员）

**路径：** 管理后台 → 分类管理

**功能：**
- ✅ 创建活动分类（名称、图标、排序）
- ✅ 编辑分类信息
- ✅ 删除分类
- ✅ 分类排序（数字越小越靠前）

**操作步骤：**
1. 登录管理员账号
2. 进入"管理后台"
3. 点击"分类管理"
4. 点击右上角"添加分类"
5. 输入分类名称（如：毕业照、艺术照等）
6. 选择分类图标（emoji）
7. 设置排序数字
8. 点击"保存"

**示例分类：**
- 📸 证件照（排序：0）
- 🎓 毕业照（排序：1）
- 🎨 艺术照（排序：2）
- 🎉 节日活动（排序：3）

---

### 2. 活动管理（管理员）

**路径：** 管理后台 → 活动管理

**功能：**
- ✅ 创建活动（关联分类）
- ✅ 编辑活动信息
- ✅ 上传活动图片
- ✅ 绑定摄影师
- ✅ 设置价格
- ✅ 发布/下架活动

**特殊说明：**
- "证件照"为默认活动，不可删除
- 默认活动不会显示在公共活动列表中
- 默认活动的价格会用于入学申请流程

---

### 3. 订单状态系统

#### 订单状态流转图

```
待支付 ──┬──→ 已支付 ──→ 进行中 ──→ 已完成
         │                    ↓         ↓
         └──→ 已取消         售后中 ←─┘
                              ↓
                            已退款
```

#### 状态详解

| 状态 | 图标 | 颜色 | 说明 | 用户操作 | 管理员操作 |
|------|------|------|------|----------|-----------|
| 待支付 | 💰 | 橙色 | 订单已创建，等待支付 | 立即支付、取消订单 | 取消订单 |
| 已支付 | ✅ | 蓝色 | 已支付，等待拍摄 | 联系摄影师 | 开始拍摄、退款 |
| 进行中 | 📸 | 紫色 | 正在拍摄/制作中 | 联系摄影师、申请售后 | 标记完成、退款 |
| 已完成 | 🎉 | 绿色 | 订单已完成 | 评价、申请售后 | 退款 |
| 售后中 | 🔧 | 红色 | 用户申请售后 | 联系客服 | 同意退款、拒绝售后 |
| 已退款 | 💸 | 灰色 | 订单已退款 | 无 | 无 |
| 已取消 | ❌ | 浅灰 | 订单已取消 | 无 | 无 |

---

### 4. 后台订单管理（管理员）

**路径：** 管理后台 → 订单管理

**功能：**
- ✅ 查看所有订单
- ✅ 按状态筛选订单
- ✅ 查看订单详情
- ✅ 修改订单状态
- ✅ 处理售后申请
- ✅ 联系用户

**操作流程：**

1. **查看订单列表**
   - 点击状态标签筛选订单
   - 点击订单卡片查看详情

2. **处理订单**
   - **已支付订单：** 点击"开始拍摄" → 订单变为"进行中"
   - **进行中订单：** 点击"标记完成" → 订单变为"已完成"
   - **售后订单：** 
     - 点击"同意退款" → 订单变为"已退款"
     - 点击"拒绝售后" → 订单返回"进行中"

3. **联系用户**
   - 订单详情页显示用户OpenID
   - 如用户留有电话，可直接拨打

---

### 5. 用户端订单管理

**路径：** 我的 → 我的订单

**功能：**
- ✅ 查看个人订单列表
- ✅ 按状态筛选订单
- ✅ 查看订单详情
- ✅ 订单操作（取消、支付、申请售后等）

**用户操作说明：**

1. **待支付订单**
   - 点击"立即支付"完成支付（功能开发中）
   - 点击"取消订单"取消

2. **已支付/进行中订单**
   - 点击"联系摄影师"拨打电话
   - 点击"申请售后"填写售后原因

3. **已完成订单**
   - 点击"评价"对服务进行评价（功能开发中）
   - 点击"申请售后"如有问题

---

## 📊 数据库集合

系统需要创建以下云数据库集合：

### 1. `activity_categories` - 活动分类
```json
{
  "_id": "自动生成",
  "name": "分类名称",
  "icon": "分类图标（emoji）",
  "sort": 0,
  "createdAt": "创建时间"
}
```

### 2. `activities` - 活动信息
```json
{
  "_id": "自动生成",
  "title": "活动标题",
  "subtitle": "副标题",
  "coverImage": "封面图片",
  "images": ["图片数组"],
  "description": "简介",
  "details": "详细说明",
  "price": 价格,
  "category": "分类名称",
  "photographerIds": ["摄影师ID数组"],
  "tags": ["标签数组"],
  "status": "active/inactive",
  "isDefault": false,
  "viewCount": 0,
  "orderCount": 0,
  "createdAt": "创建时间",
  "updatedAt": "更新时间"
}
```

### 3. `activity_orders` - 活动订单
```json
{
  "_id": "自动生成",
  "_openid": "用户OpenID",
  "activityId": "活动ID",
  "photographerId": "摄影师ID",
  "orderNo": "订单号（可选）",
  "totalPrice": 订单金额,
  "status": "订单状态",
  "remark": "备注",
  "afterSaleReason": "售后原因",
  "createdAt": "创建时间",
  "updatedAt": "更新时间"
}
```

---

## 🚀 快速开始

### 第一步：创建数据库集合

1. 打开微信开发者工具
2. 点击"云开发" → "数据库"
3. 创建以下集合：
   - `activity_categories`
   - `activities`（如已存在则跳过）
   - `activity_orders`（如已存在则跳过）

### 第二步：创建活动分类

1. 登录管理员账号
2. 进入"管理后台" → "分类管理"
3. 添加以下分类：
   ```
   证件照  📸  排序：0
   毕业照  🎓  排序：1
   艺术照  🎨  排序：2
   节日活动 🎉  排序：3
   ```

### 第三步：创建活动

1. 进入"活动管理" → 点击"发布活动"
2. 填写活动信息
3. 选择分类
4. 上传活动图片
5. 绑定摄影师
6. 设置价格
7. 点击"发布"

### 第四步：测试订单流程

1. **用户端测试：**
   - 切换到普通用户账号
   - 浏览活动列表
   - 点击活动查看详情
   - 点击"立即报名"创建订单
   - 在"我的订单"中查看订单

2. **管理员测试：**
   - 切换回管理员账号
   - 进入"订单管理"
   - 处理订单（开始拍摄 → 标记完成）

---

## 💡 使用技巧

### 1. 分类管理技巧
- 使用emoji图标让分类更生动
- 排序数字建议间隔10（如：0, 10, 20），方便后续插入新分类
- 常用分类排序数字设小一些

### 2. 活动管理技巧
- 封面图要清晰、吸引人
- 价格设置要合理
- 详细说明中列出服务内容
- 及时更新活动状态（上架/下架）

### 3. 订单处理技巧
- 及时处理"已支付"订单
- 主动联系用户确认拍摄时间
- 售后申请要认真查看原因
- 保持良好的用户沟通

---

## ⚠️ 注意事项

1. **证件照活动**
   - 不要删除"证件照"默认活动
   - 该活动用于入学申请流程
   - 价格修改会影响入学申请显示的价格

2. **订单状态**
   - 状态修改后无法撤销
   - 退款操作请谨慎
   - 建议与用户沟通后再操作

3. **分类删除**
   - 删除分类不会删除该分类下的活动
   - 删除后，原分类的活动会变为"未分类"

4. **数据安全**
   - 定期备份订单数据
   - 重要操作前确认无误

---

## 🔄 订单处理流程示例

### 场景1：正常订单流程

1. 用户下单 → **待支付**
2. 用户支付 → **已支付**
3. 管理员点击"开始拍摄" → **进行中**
4. 拍摄完成，管理员点击"标记完成" → **已完成**
5. 用户满意，点击"评价" → 订单结束

### 场景2：用户申请售后

1. 订单**进行中**或**已完成**
2. 用户点击"申请售后"，填写原因 → **售后中**
3. 管理员查看售后原因：
   - 如同意退款 → **已退款**
   - 如拒绝售后 → 返回**进行中**

### 场景3：订单取消

1. 订单**待支付**
2. 用户或管理员点击"取消订单" → **已取消**

---

## 📞 技术支持

如遇问题，请检查：
1. 云数据库集合是否正确创建
2. 权限配置是否正确
3. 云函数是否部署成功
4. 网络连接是否正常

---

## 🎉 总结

活动订单系统现已完整实现以下功能：

✅ **分类管理** - 灵活的活动分类系统
✅ **活动管理** - 完善的活动发布和管理
✅ **订单状态** - 7种订单状态，覆盖全流程
✅ **后台管理** - 强大的订单处理功能
✅ **用户端** - 友好的订单查看和操作
✅ **权限控制** - 基于角色的操作权限
✅ **数据关联** - 订单-活动-用户-摄影师联动

系统已准备就绪，开始使用吧！🚀

