# ğŸ¯ æ´»åŠ¨æ¨¡å—è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

æ´»åŠ¨æ¨¡å—æ˜¯æ•´ä¸ªå­¦æ ¡å°ç¨‹åºçš„**æ ¸å¿ƒå±•ç¤ºæ¨¡å—**ï¼Œç±»ä¼¼äº"å•†å“æ©±çª—"æˆ–"æ´»åŠ¨å•†åŸ"ã€‚

### æ ¸å¿ƒç†å¿µ
- æ¯ä¸ªæ´»åŠ¨éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„"å•†å“"
- ç”¨æˆ·å¯ä»¥æµè§ˆã€é€‰æ‹©å¹¶å‚ä¸ä¸åŒçš„æ‹æ‘„æ´»åŠ¨
- ç®¡ç†å‘˜å¯ä»¥çµæ´»ä¸Šæ¶/ä¸‹æ¶æ´»åŠ¨
- è¯ä»¶ç…§æ‹æ‘„ä¹Ÿæ˜¯ä¸€ä¸ªæ´»åŠ¨ï¼ˆé»˜è®¤åŸºç¡€æ´»åŠ¨ï¼‰

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### 1. æ´»åŠ¨é›†åˆ (activities)

```javascript
{
  _id: "activity_001",
  _openid: "xxx",  // åˆ›å»ºè€…openid
  
  // åŸºæœ¬ä¿¡æ¯
  title: "æ ¡å›­è¯ä»¶ç…§æ‹æ‘„",
  subtitle: "ä¸“ä¸šè¯ä»¶ç…§ï¼Œä¸€å¯¸/ä¸¤å¯¸å¯é€‰",
  coverImage: "cloud://xxx.jpg",  // å°é¢å›¾
  
  // æ´»åŠ¨è¯¦æƒ…
  description: "ä¸“ä¸šæ‘„å½±å¸ˆä¸ºæ‚¨æ‹æ‘„æ ‡å‡†è¯ä»¶ç…§ï¼ŒåŒ…å«ç²¾ä¿®ã€åº•ç‰‡...",
  details: `
    ã€æœåŠ¡å†…å®¹ã€‘
    âœ… ä¸“ä¸šæ‘„å½±å¸ˆæ‹æ‘„
    âœ… 5å¼ ç²¾ä¿®ç…§ç‰‡
    âœ… ç”µå­åº•ç‰‡
    âœ… ä¸€å¯¸/ä¸¤å¯¸å¯é€‰
    
    ã€æ‹æ‘„æµç¨‹ã€‘
    1. é€‰æ‹©æ‘„å½±å¸ˆ
    2. æ”¯ä»˜è®¢å•
    3. æ‘„å½±å¸ˆæ‹æ‘„
    4. å®¢æœå®¡æ ¸
    5. å®¶é•¿ç¡®è®¤
    6. ä¸‹è½½ç…§ç‰‡
  `,
  
  // ä»·æ ¼ä¿¡æ¯
  price: 20,  // å½“å‰ä»·æ ¼ï¼ˆå…ƒï¼‰
  originalPrice: 30,  // åŸä»·ï¼ˆç”¨äºæ˜¾ç¤ºä¼˜æƒ ï¼‰
  
  // å›¾ç‰‡å±•ç¤º
  images: [
    "cloud://gallery1.jpg",
    "cloud://gallery2.jpg",
    "cloud://gallery3.jpg"
  ],
  
  // æ‘„å½±å¸ˆé…ç½®
  photographerIds: [
    "photographer_001",
    "photographer_002"
  ],
  
  // æ´»åŠ¨æ ‡ç­¾
  tags: ["è¯ä»¶ç…§", "å¿…å¤‡", "çƒ­é—¨"],
  category: "è¯ä»¶ç…§",  // åˆ†ç±»ï¼šè¯ä»¶ç…§ã€æ ¡å›­æ´»åŠ¨ã€æ¯•ä¸šç…§ã€èŠ‚æ—¥æ´»åŠ¨
  
  // æ´»åŠ¨çŠ¶æ€
  status: "active",  // active=ä¸Šæ¶, inactive=ä¸‹æ¶, draft=è‰ç¨¿
  isHot: true,  // æ˜¯å¦çƒ­é—¨
  isNew: false,  // æ˜¯å¦æ–°å“
  
  // ç»Ÿè®¡ä¿¡æ¯
  viewCount: 1250,  // æµè§ˆæ¬¡æ•°
  orderCount: 58,   // è®¢å•æ•°é‡
  
  // æ’åºæƒé‡
  sortOrder: 1,  // æ•°å­—è¶Šå°è¶Šé å‰
  
  // æ—¶é—´æˆ³
  createdAt: "2025-10-14T12:00:00.000Z",
  updatedAt: "2025-10-14T12:00:00.000Z"
}
```

---

### 2. æ´»åŠ¨è®¢å•é›†åˆ (activity_orders)

```javascript
{
  _id: "order_001",
  _openid: "xxx",  // ä¸‹å•ç”¨æˆ·çš„openid
  
  // æ´»åŠ¨ä¿¡æ¯
  activityId: "activity_001",
  activityTitle: "æ ¡å›­è¯ä»¶ç…§æ‹æ‘„",
  activityCover: "cloud://xxx.jpg",
  
  // ç”¨æˆ·ä¿¡æ¯
  childName: "å°æ˜",
  childGender: "ç”·",
  childAge: 8,
  childPhoto: "cloud://life_photo.jpg",  // ç”Ÿæ´»ç…§
  
  parentName: "å¼ å¥³å£«",
  parentPhone: "13800138000",
  parentWechat: "zhangsan123",
  expectations: "å¸Œæœ›å­©å­ç¬‘å®¹è‡ªç„¶ä¸€ç‚¹",
  
  // æ‘„å½±å¸ˆä¿¡æ¯
  photographerId: "photographer_001",
  photographerName: "æè€å¸ˆ",
  photographerAvatar: "cloud://avatar.jpg",
  
  // è®¢å•çŠ¶æ€
  status: "waiting_shoot",  // è®¢å•çŠ¶æ€ï¼ˆè§ä¸‹æ–¹çŠ¶æ€æµè½¬ï¼‰
  
  // ä½œå“ä¿¡æ¯
  workImage: "cloud://work.jpg",  // æ‘„å½±å¸ˆä¸Šä¼ çš„æˆå“
  workRemark: "å·²å®Œæˆæ‹æ‘„ï¼Œè¯·å®¡æ ¸",
  
  // å®¡æ ¸ä¿¡æ¯
  reviewStatus: "pending",  // pending=å¾…å®¡æ ¸, approved=é€šè¿‡, rejected=é©³å›
  reviewRemark: "",
  reviewedAt: null,
  
  // ç¡®è®¤ä¿¡æ¯
  confirmedAt: null,
  
  // ä»·æ ¼ä¿¡æ¯
  price: 20,
  paymentStatus: "paid",  // pending=å¾…æ”¯ä»˜, paid=å·²æ”¯ä»˜, refunded=å·²é€€æ¬¾
  paymentTime: "2025-10-14T12:00:00.000Z",
  
  // æ—¶é—´æˆ³
  createdAt: "2025-10-14T12:00:00.000Z",
  updatedAt: "2025-10-14T12:00:00.000Z"
}
```

---

### 3. è®¢å•çŠ¶æ€æµè½¬

```
1. waiting_shoot     ç­‰å¾…æ‹æ‘„
   â†“ æ‘„å½±å¸ˆä¸Šä¼ ä½œå“
   
2. pending_review    å¾…å®¢æœå®¡æ ¸
   â†“ å®¢æœå®¡æ ¸é€šè¿‡
   
3. pending_confirm   å¾…å®¶é•¿ç¡®è®¤
   â†“ å®¶é•¿ç¡®è®¤
   
4. confirmed         å·²ç¡®è®¤ï¼ˆç”Ÿæˆæ¡£æ¡ˆï¼‰
   â†“ å®¢æœä¸Šä¼ å½•å–é€šçŸ¥ä¹¦
   
5. archived          æ¡£æ¡ˆå·²å½’æ¡£

âŒ rejected          å®¡æ ¸é©³å›ï¼ˆè¿”å›æ­¥éª¤1ï¼‰
âŒ cancelled         å·²å–æ¶ˆ
```

---

## ğŸ¨ å‰ç«¯é¡µé¢è®¾è®¡

### 1. é¦–é¡µæ´»åŠ¨å±•ç¤º (pages/index/index)

#### å¸ƒå±€è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ å…¨éƒ¨æ´»åŠ¨                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [è¯ä»¶ç…§] [æ˜¥æ¸¸] [æ¯•ä¸šç…§] ... â”‚  â† åˆ†ç±»ç­›é€‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  ğŸ“·      â”‚ â”‚  ğŸŒ¸      â”‚ â”‚
â”‚ â”‚ è¯ä»¶ç…§    â”‚ â”‚ æ˜¥æ¸¸æ‘„å½±  â”‚ â”‚
â”‚ â”‚ Â¥20      â”‚ â”‚ Â¥20      â”‚ â”‚
â”‚ â”‚ ğŸ”¥çƒ­é—¨   â”‚ â”‚ ğŸ†•æ–°å“   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  ğŸ“      â”‚ â”‚  ğŸ„      â”‚ â”‚
â”‚ â”‚ æ¯•ä¸šç…§    â”‚ â”‚ èŠ‚æ—¥æ´»åŠ¨  â”‚ â”‚
â”‚ â”‚ Â¥20      â”‚ â”‚ Â¥20      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åŠŸèƒ½ç‚¹
- Grid 2åˆ—å¸ƒå±€
- åˆ†ç±»ç­›é€‰ï¼ˆå…¨éƒ¨ã€è¯ä»¶ç…§ã€æ ¡å›­æ´»åŠ¨ç­‰ï¼‰
- çƒ­é—¨ã€æ–°å“æ ‡ç­¾
- æµè§ˆæ¬¡æ•°æ˜¾ç¤º
- ç‚¹å‡»è·³è½¬è¯¦æƒ…é¡µ

---

### 2. æ´»åŠ¨è¯¦æƒ…é¡µ (pages/activity/detail)

#### å¸ƒå±€è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [< è¿”å›]         [åˆ†äº«]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“· å¤§å°é¢å›¾                 â”‚
â”‚  (è½®æ’­å¤šå¼ )                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ ¡å›­è¯ä»¶ç…§æ‹æ‘„               â”‚
â”‚  ä¸“ä¸šè¯ä»¶ç…§ï¼Œä¸€å¯¸/ä¸¤å¯¸å¯é€‰     â”‚
â”‚                              â”‚
â”‚  Â¥20  åŸä»· Â¥30               â”‚
â”‚  ğŸ”¥ å·²æœ‰58äººå‚åŠ               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ æ´»åŠ¨ä»‹ç»                 â”‚
â”‚  ä¸“ä¸šæ‘„å½±å¸ˆä¸ºæ‚¨æ‹æ‘„...        â”‚
â”‚                              â”‚
â”‚  ğŸ“‹ æœåŠ¡å†…å®¹                 â”‚
â”‚  âœ… ä¸“ä¸šæ‘„å½±å¸ˆæ‹æ‘„            â”‚
â”‚  âœ… 5å¼ ç²¾ä¿®ç…§ç‰‡               â”‚
â”‚  ...                         â”‚
â”‚                              â”‚
â”‚  ğŸ‘¨â€ğŸ¨ å¯é€‰æ‘„å½±å¸ˆ (3ä½)        â”‚
â”‚  [æè€å¸ˆ] [ç‹è€å¸ˆ] [èµµè€å¸ˆ]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ç«‹å³å‚åŠ  Â¥20] å›ºå®šåº•éƒ¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åŠŸèƒ½ç‚¹
- è½®æ’­å›¾å±•ç¤ºå¤šå¼ æ´»åŠ¨å›¾ç‰‡
- ä»·æ ¼å¯¹æ¯”ï¼ˆåŸä»·/ç°ä»·ï¼‰
- æ´»åŠ¨è¯¦ç»†ä»‹ç»ï¼ˆå¯Œæ–‡æœ¬ï¼‰
- å¯é€‰æ‘„å½±å¸ˆåˆ—è¡¨
- ç«‹å³å‚åŠ æŒ‰é’®ï¼ˆè·³è½¬åˆ°æŠ¥åé¡µï¼‰

---

### 3. æ´»åŠ¨æŠ¥åé¡µ (pages/activity/apply)

#### å¸ƒå±€è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [< è¿”å›] æ´»åŠ¨æŠ¥å             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ´»åŠ¨ï¼šæ ¡å›­è¯ä»¶ç…§æ‹æ‘„          â”‚
â”‚  ä»·æ ¼ï¼šÂ¥20                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¶ å­©å­ä¿¡æ¯                 â”‚
â”‚  å§“å: [____]                â”‚
â”‚  æ€§åˆ«: â—‹ç”· â—‹å¥³               â”‚
â”‚  å¹´é¾„: [____]                â”‚
â”‚  ç”Ÿæ´»ç…§: [ä¸Šä¼ ]               â”‚
â”‚                              â”‚
â”‚  ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ å®¶é•¿ä¿¡æ¯                â”‚
â”‚  å§“å: [____]                â”‚
â”‚  æ‰‹æœº: [____]                â”‚
â”‚  å¾®ä¿¡: [____]                â”‚
â”‚  æœŸæœ›: [____________]         â”‚
â”‚                              â”‚
â”‚  ğŸ‘¨â€ğŸ¨ é€‰æ‹©æ‘„å½±å¸ˆ              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚æè€å¸ˆâ”‚ â”‚ç‹è€å¸ˆâ”‚            â”‚
â”‚  â”‚ â­4.9â”‚ â”‚ â­4.8â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [æäº¤è®¢å• Â¥20] å›ºå®šåº•éƒ¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åŠŸèƒ½ç‚¹
- è¡¨å•éªŒè¯
- ç”Ÿæ´»ç…§ä¸Šä¼ ï¼ˆäº‘å­˜å‚¨ï¼‰
- æ‘„å½±å¸ˆé€‰æ‹©ï¼ˆå±•ç¤ºè¯„åˆ†ï¼‰
- æäº¤ååˆ›å»ºè®¢å•
- è·³è½¬åˆ°æ”¯ä»˜é¡µé¢

---

## ğŸ”§ åå°ç®¡ç†è®¾è®¡

### 1. æ´»åŠ¨ç®¡ç†é¡µé¢ (admin/pages/activities.html)

#### åŠŸèƒ½åˆ—è¡¨
- æ´»åŠ¨åˆ—è¡¨å±•ç¤ºï¼ˆè¡¨æ ¼ï¼‰
- åˆ›å»ºæ´»åŠ¨
- ç¼–è¾‘æ´»åŠ¨
- åˆ é™¤æ´»åŠ¨
- ä¸Šæ¶/ä¸‹æ¶
- è®¾ç½®çƒ­é—¨/æ–°å“
- é…ç½®æ‘„å½±å¸ˆ
- æŸ¥çœ‹ç»Ÿè®¡æ•°æ®

#### è¡¨æ ¼åˆ—
| å°é¢ | æ´»åŠ¨åç§° | åˆ†ç±» | ä»·æ ¼ | çŠ¶æ€ | è®¢å•æ•° | æµè§ˆæ•° | æ“ä½œ |
|------|---------|------|------|------|--------|--------|------|
| ğŸ“·  | è¯ä»¶ç…§   | è¯ä»¶ç…§| Â¥20 | ä¸Šæ¶ | 58    | 1250   | ç¼–è¾‘/ä¸‹æ¶ |

---

### 2. æ´»åŠ¨ç¼–è¾‘é¡µé¢ (admin/pages/activity-edit.html)

#### è¡¨å•å­—æ®µ
```
åŸºæœ¬ä¿¡æ¯
â”œâ”€ æ´»åŠ¨æ ‡é¢˜ *
â”œâ”€ å‰¯æ ‡é¢˜
â”œâ”€ å°é¢å›¾ç‰‡ * (ä¸Šä¼ åˆ°äº‘å­˜å‚¨)
â”œâ”€ åˆ†ç±» * (ä¸‹æ‹‰é€‰æ‹©)
â””â”€ æ ‡ç­¾ (å¤šé€‰)

è¯¦ç»†ä¿¡æ¯
â”œâ”€ ç®€ä»‹ (textarea)
â”œâ”€ è¯¦ç»†ä»‹ç» (å¯Œæ–‡æœ¬)
â””â”€ æ´»åŠ¨å›¾ç‰‡ (å¤šå›¾ä¸Šä¼ )

ä»·æ ¼é…ç½®
â”œâ”€ å½“å‰ä»·æ ¼ *
â””â”€ åŸä»·

æ‘„å½±å¸ˆé…ç½®
â””â”€ å¯é€‰æ‘„å½±å¸ˆ (å¤šé€‰)

çŠ¶æ€è®¾ç½®
â”œâ”€ ä¸Šæ¶çŠ¶æ€ (å¼€å…³)
â”œâ”€ çƒ­é—¨æ¨è (å¼€å…³)
â”œâ”€ æ–°å“æ ‡è®° (å¼€å…³)
â””â”€ æ’åºæƒé‡ (æ•°å­—)
```

---

### 3. è®¢å•ç®¡ç†é¡µé¢ (admin/pages/activity-orders.html)

#### åŠŸèƒ½åˆ—è¡¨
- è®¢å•åˆ—è¡¨
- çŠ¶æ€ç­›é€‰
- æœç´¢ï¼ˆå­©å­å§“åã€å®¶é•¿æ‰‹æœºï¼‰
- æŸ¥çœ‹è®¢å•è¯¦æƒ…
- åˆ†é…æ‘„å½±å¸ˆ
- å®¢æœå®¡æ ¸ï¼ˆé€šè¿‡/é©³å›ï¼‰
- ä¸Šä¼ å½•å–é€šçŸ¥ä¹¦
- å¯¼å‡ºè®¢å•æ•°æ®

#### çŠ¶æ€ç­›é€‰
- å…¨éƒ¨
- ç­‰å¾…æ‹æ‘„
- å¾…å®¡æ ¸
- å¾…ç¡®è®¤
- å·²å®Œæˆ
- å·²å–æ¶ˆ

---

## ğŸ› ï¸ äº‘å‡½æ•°è®¾è®¡

### 1. getActivities
```javascript
// è·å–æ´»åŠ¨åˆ—è¡¨
exports.main = async (event, context) => {
  const { category, status, keyword, limit = 20, skip = 0 } = event;
  
  const db = cloud.database();
  const _ = db.command;
  
  let query = {};
  
  if (category) query.category = category;
  if (status) query.status = status;
  if (keyword) query.title = db.RegExp({ regexp: keyword, options: 'i' });
  
  const res = await db.collection('activities')
    .where(query)
    .orderBy('sortOrder', 'asc')
    .orderBy('createdAt', 'desc')
    .skip(skip)
    .limit(limit)
    .get();
    
  return { data: res.data, total: res.data.length };
};
```

---

### 2. getActivityDetail
```javascript
// è·å–æ´»åŠ¨è¯¦æƒ…
exports.main = async (event, context) => {
  const { activityId } = event;
  const db = cloud.database();
  
  // è·å–æ´»åŠ¨ä¿¡æ¯
  const activity = await db.collection('activities')
    .doc(activityId)
    .get();
    
  if (!activity.data) {
    return { error: 'æ´»åŠ¨ä¸å­˜åœ¨' };
  }
  
  // å¢åŠ æµè§ˆæ¬¡æ•°
  await db.collection('activities')
    .doc(activityId)
    .update({
      data: {
        viewCount: db.command.inc(1)
      }
    });
    
  // è·å–æ‘„å½±å¸ˆä¿¡æ¯
  const photographers = await db.collection('photographers')
    .where({
      _id: db.command.in(activity.data.photographerIds)
    })
    .get();
    
  return {
    activity: activity.data,
    photographers: photographers.data
  };
};
```

---

### 3. createActivityOrder
```javascript
// åˆ›å»ºæ´»åŠ¨è®¢å•
exports.main = async (event, context) => {
  const wxContext = cloud.getWXContext();
  const db = cloud.database();
  
  const {
    activityId,
    childName,
    childGender,
    childAge,
    childPhoto,
    parentName,
    parentPhone,
    parentWechat,
    expectations,
    photographerId
  } = event;
  
  // è·å–æ´»åŠ¨ä¿¡æ¯
  const activity = await db.collection('activities').doc(activityId).get();
  
  if (!activity.data || activity.data.status !== 'active') {
    return { error: 'æ´»åŠ¨ä¸å­˜åœ¨æˆ–å·²ä¸‹æ¶' };
  }
  
  // è·å–æ‘„å½±å¸ˆä¿¡æ¯
  const photographer = await db.collection('photographers').doc(photographerId).get();
  
  // åˆ›å»ºè®¢å•
  const order = await db.collection('activity_orders').add({
    data: {
      _openid: wxContext.OPENID,
      activityId,
      activityTitle: activity.data.title,
      activityCover: activity.data.coverImage,
      childName,
      childGender,
      childAge,
      childPhoto,
      parentName,
      parentPhone,
      parentWechat,
      expectations,
      photographerId,
      photographerName: photographer.data.name,
      photographerAvatar: photographer.data.avatar,
      status: 'waiting_shoot',
      price: activity.data.price,
      paymentStatus: 'pending',
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    }
  });
  
  // æ›´æ–°æ´»åŠ¨è®¢å•æ•°
  await db.collection('activities').doc(activityId).update({
    data: {
      orderCount: db.command.inc(1)
    }
  });
  
  return { orderId: order._id };
};
```

---

## ğŸ“± ç”¨æˆ·æµç¨‹

### å‚ä¸æ´»åŠ¨å®Œæ•´æµç¨‹

```
1. æµè§ˆé¦–é¡µæ´»åŠ¨
   â†“
2. ç‚¹å‡»æ„Ÿå…´è¶£çš„æ´»åŠ¨
   â†“
3. æŸ¥çœ‹æ´»åŠ¨è¯¦æƒ…
   â†“
4. ç‚¹å‡»ã€Œç«‹å³å‚åŠ ã€
   â†“
5. å¡«å†™å­©å­å’Œå®¶é•¿ä¿¡æ¯
   â†“
6. é€‰æ‹©æ‘„å½±å¸ˆ
   â†“
7. æäº¤è®¢å•
   â†“
8. æ”¯ä»˜ï¼ˆæ¨¡æ‹Ÿï¼‰
   â†“
9. ç­‰å¾…æ‘„å½±å¸ˆæ‹æ‘„
   â†“
10. æŸ¥çœ‹è®¢å•çŠ¶æ€
   â†“
11. ç¡®è®¤ç…§ç‰‡
   â†“
12. ä¸‹è½½ç…§ç‰‡/æŸ¥çœ‹æ¡£æ¡ˆ
```

---

## ğŸ¯ å¼€å‘ä¼˜å…ˆçº§

### Phase 1: æ•°æ®åº“å’Œäº‘å‡½æ•°ï¼ˆå½“å‰ï¼‰
- [x] è®¾è®¡æ•°æ®åº“ç»“æ„
- [ ] åˆ›å»ºäº‘æ•°æ®åº“é›†åˆ
- [ ] å¼€å‘äº‘å‡½æ•°

### Phase 2: åå°ç®¡ç†
- [ ] æ´»åŠ¨ç®¡ç†é¡µé¢
- [ ] æ´»åŠ¨ç¼–è¾‘é¡µé¢
- [ ] è®¢å•ç®¡ç†é¡µé¢

### Phase 3: å°ç¨‹åºå‰ç«¯
- [ ] é¦–é¡µæ´»åŠ¨å±•ç¤º
- [ ] æ´»åŠ¨è¯¦æƒ…é¡µ
- [ ] æ´»åŠ¨æŠ¥åé¡µ
- [ ] æˆ‘çš„è®¢å•é¡µ

### Phase 4: æµç¨‹å®Œå–„
- [ ] æ‘„å½±å¸ˆä»»åŠ¡é¡µ
- [ ] å®¢æœå®¡æ ¸æµç¨‹
- [ ] å®¶é•¿ç¡®è®¤æµç¨‹
- [ ] æ¡£æ¡ˆè‡ªåŠ¨ç”Ÿæˆ

---

## ğŸ’¡ æ‰©å±•æ€§è®¾è®¡

### æœªæ¥å¯æ·»åŠ çš„æ´»åŠ¨ç±»å‹
- æ˜¥æ¸¸æ‘„å½±æ´»åŠ¨
- å¤ä»¤è¥åˆå½±
- æ¯•ä¸šç…§æ‹æ‘„
- èŠ‚æ—¥ä¸»é¢˜æ‹æ‘„
- å®¶åº­åˆå½±
- æ‰è‰ºå±•ç¤ºæ‹æ‘„

### æœªæ¥å¯æ·»åŠ çš„åŠŸèƒ½
- æ´»åŠ¨è¯„ä»·ç³»ç»Ÿ
- æ‘„å½±å¸ˆè¯„åˆ†
- ä¼˜æƒ åˆ¸ç³»ç»Ÿ
- æ‹¼å›¢æ´»åŠ¨
- é™æ—¶ç§’æ€
- ç§¯åˆ†ç³»ç»Ÿ
- ä¼šå‘˜ç³»ç»Ÿ

---

**è®¾è®¡å®Œæˆï¼ç°åœ¨å¼€å§‹å®æ–½ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºäº‘æ•°æ®åº“å’Œäº‘å‡½æ•°** ğŸš€

