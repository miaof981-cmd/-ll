# 🎯 活动模块设计文档

## 📋 模块概述

活动模块是整个学校小程序的**核心展示模块**，类似于"商品橱窗"或"活动商城"。

### 核心理念
- 每个活动都是一个独立的"商品"
- 用户可以浏览、选择并参与不同的拍摄活动
- 管理员可以灵活上架/下架活动
- 证件照拍摄也是一个活动（默认基础活动）

---

## 🗄️ 数据库设计

### 1. 活动集合 (activities)

```javascript
{
  _id: "activity_001",
  _openid: "xxx",  // 创建者openid
  
  // 基本信息
  title: "校园证件照拍摄",
  subtitle: "专业证件照，一寸/两寸可选",
  coverImage: "cloud://xxx.jpg",  // 封面图
  
  // 活动详情
  description: "专业摄影师为您拍摄标准证件照，包含精修、底片...",
  details: `
    【服务内容】
    ✅ 专业摄影师拍摄
    ✅ 5张精修照片
    ✅ 电子底片
    ✅ 一寸/两寸可选
    
    【拍摄流程】
    1. 选择摄影师
    2. 支付订单
    3. 摄影师拍摄
    4. 客服审核
    5. 家长确认
    6. 下载照片
  `,
  
  // 价格信息
  price: 20,  // 当前价格（元）
  originalPrice: 30,  // 原价（用于显示优惠）
  
  // 图片展示
  images: [
    "cloud://gallery1.jpg",
    "cloud://gallery2.jpg",
    "cloud://gallery3.jpg"
  ],
  
  // 摄影师配置
  photographerIds: [
    "photographer_001",
    "photographer_002"
  ],
  
  // 活动标签
  tags: ["证件照", "必备", "热门"],
  category: "证件照",  // 分类：证件照、校园活动、毕业照、节日活动
  
  // 活动状态
  status: "active",  // active=上架, inactive=下架, draft=草稿
  isHot: true,  // 是否热门
  isNew: false,  // 是否新品
  
  // 统计信息
  viewCount: 1250,  // 浏览次数
  orderCount: 58,   // 订单数量
  
  // 排序权重
  sortOrder: 1,  // 数字越小越靠前
  
  // 时间戳
  createdAt: "2025-10-14T12:00:00.000Z",
  updatedAt: "2025-10-14T12:00:00.000Z"
}
```

---

### 2. 活动订单集合 (activity_orders)

```javascript
{
  _id: "order_001",
  _openid: "xxx",  // 下单用户的openid
  
  // 活动信息
  activityId: "activity_001",
  activityTitle: "校园证件照拍摄",
  activityCover: "cloud://xxx.jpg",
  
  // 用户信息
  childName: "小明",
  childGender: "男",
  childAge: 8,
  childPhoto: "cloud://life_photo.jpg",  // 生活照
  
  parentName: "张女士",
  parentPhone: "13800138000",
  parentWechat: "zhangsan123",
  expectations: "希望孩子笑容自然一点",
  
  // 摄影师信息
  photographerId: "photographer_001",
  photographerName: "李老师",
  photographerAvatar: "cloud://avatar.jpg",
  
  // 订单状态
  status: "waiting_shoot",  // 订单状态（见下方状态流转）
  
  // 作品信息
  workImage: "cloud://work.jpg",  // 摄影师上传的成品
  workRemark: "已完成拍摄，请审核",
  
  // 审核信息
  reviewStatus: "pending",  // pending=待审核, approved=通过, rejected=驳回
  reviewRemark: "",
  reviewedAt: null,
  
  // 确认信息
  confirmedAt: null,
  
  // 价格信息
  price: 20,
  paymentStatus: "paid",  // pending=待支付, paid=已支付, refunded=已退款
  paymentTime: "2025-10-14T12:00:00.000Z",
  
  // 时间戳
  createdAt: "2025-10-14T12:00:00.000Z",
  updatedAt: "2025-10-14T12:00:00.000Z"
}
```

---

### 3. 订单状态流转

```
1. waiting_shoot     等待拍摄
   ↓ 摄影师上传作品
   
2. pending_review    待客服审核
   ↓ 客服审核通过
   
3. pending_confirm   待家长确认
   ↓ 家长确认
   
4. confirmed         已确认（生成档案）
   ↓ 客服上传录取通知书
   
5. archived          档案已归档

❌ rejected          审核驳回（返回步骤1）
❌ cancelled         已取消
```

---

## 🎨 前端页面设计

### 1. 首页活动展示 (pages/index/index)

#### 布局设计
```
┌─────────────────────────────┐
│  🎯 全部活动                 │
├─────────────────────────────┤
│ [证件照] [春游] [毕业照] ... │  ← 分类筛选
├─────────────────────────────┤
│ ┌───────────┐ ┌───────────┐ │
│ │  📷      │ │  🌸      │ │
│ │ 证件照    │ │ 春游摄影  │ │
│ │ ¥20      │ │ ¥20      │ │
│ │ 🔥热门   │ │ 🆕新品   │ │
│ └───────────┘ └───────────┘ │
│ ┌───────────┐ ┌───────────┐ │
│ │  🎓      │ │  🎄      │ │
│ │ 毕业照    │ │ 节日活动  │ │
│ │ ¥20      │ │ ¥20      │ │
│ └───────────┘ └───────────┘ │
└─────────────────────────────┘
```

#### 功能点
- Grid 2列布局
- 分类筛选（全部、证件照、校园活动等）
- 热门、新品标签
- 浏览次数显示
- 点击跳转详情页

---

### 2. 活动详情页 (pages/activity/detail)

#### 布局设计
```
┌─────────────────────────────┐
│ [< 返回]         [分享]     │
├─────────────────────────────┤
│  📷 大封面图                 │
│  (轮播多张)                  │
├─────────────────────────────┤
│  校园证件照拍摄               │
│  专业证件照，一寸/两寸可选     │
│                              │
│  ¥20  原价 ¥30               │
│  🔥 已有58人参加              │
├─────────────────────────────┤
│  📝 活动介绍                 │
│  专业摄影师为您拍摄...        │
│                              │
│  📋 服务内容                 │
│  ✅ 专业摄影师拍摄            │
│  ✅ 5张精修照片               │
│  ...                         │
│                              │
│  👨‍🎨 可选摄影师 (3位)        │
│  [李老师] [王老师] [赵老师]   │
├─────────────────────────────┤
│  [立即参加 ¥20] 固定底部      │
└─────────────────────────────┘
```

#### 功能点
- 轮播图展示多张活动图片
- 价格对比（原价/现价）
- 活动详细介绍（富文本）
- 可选摄影师列表
- 立即参加按钮（跳转到报名页）

---

### 3. 活动报名页 (pages/activity/apply)

#### 布局设计
```
┌─────────────────────────────┐
│ [< 返回] 活动报名             │
├─────────────────────────────┤
│  活动：校园证件照拍摄          │
│  价格：¥20                   │
├─────────────────────────────┤
│  👶 孩子信息                 │
│  姓名: [____]                │
│  性别: ○男 ○女               │
│  年龄: [____]                │
│  生活照: [上传]               │
│                              │
│  👨‍👩‍👧 家长信息                │
│  姓名: [____]                │
│  手机: [____]                │
│  微信: [____]                │
│  期望: [____________]         │
│                              │
│  👨‍🎨 选择摄影师              │
│  ┌─────┐ ┌─────┐            │
│  │李老师│ │王老师│            │
│  │ ⭐4.9│ │ ⭐4.8│            │
│  └─────┘ └─────┘            │
├─────────────────────────────┤
│  [提交订单 ¥20] 固定底部      │
└─────────────────────────────┘
```

#### 功能点
- 表单验证
- 生活照上传（云存储）
- 摄影师选择（展示评分）
- 提交后创建订单
- 跳转到支付页面

---

## 🔧 后台管理设计

### 1. 活动管理页面 (admin/pages/activities.html)

#### 功能列表
- 活动列表展示（表格）
- 创建活动
- 编辑活动
- 删除活动
- 上架/下架
- 设置热门/新品
- 配置摄影师
- 查看统计数据

#### 表格列
| 封面 | 活动名称 | 分类 | 价格 | 状态 | 订单数 | 浏览数 | 操作 |
|------|---------|------|------|------|--------|--------|------|
| 📷  | 证件照   | 证件照| ¥20 | 上架 | 58    | 1250   | 编辑/下架 |

---

### 2. 活动编辑页面 (admin/pages/activity-edit.html)

#### 表单字段
```
基本信息
├─ 活动标题 *
├─ 副标题
├─ 封面图片 * (上传到云存储)
├─ 分类 * (下拉选择)
└─ 标签 (多选)

详细信息
├─ 简介 (textarea)
├─ 详细介绍 (富文本)
└─ 活动图片 (多图上传)

价格配置
├─ 当前价格 *
└─ 原价

摄影师配置
└─ 可选摄影师 (多选)

状态设置
├─ 上架状态 (开关)
├─ 热门推荐 (开关)
├─ 新品标记 (开关)
└─ 排序权重 (数字)
```

---

### 3. 订单管理页面 (admin/pages/activity-orders.html)

#### 功能列表
- 订单列表
- 状态筛选
- 搜索（孩子姓名、家长手机）
- 查看订单详情
- 分配摄影师
- 客服审核（通过/驳回）
- 上传录取通知书
- 导出订单数据

#### 状态筛选
- 全部
- 等待拍摄
- 待审核
- 待确认
- 已完成
- 已取消

---

## 🛠️ 云函数设计

### 1. getActivities
```javascript
// 获取活动列表
exports.main = async (event, context) => {
  const { category, status, keyword, limit = 20, skip = 0 } = event;
  
  const db = cloud.database();
  const _ = db.command;
  
  let query = {};
  
  if (category) query.category = category;
  if (status) query.status = status;
  if (keyword) query.title = db.RegExp({ regexp: keyword, options: 'i' });
  
  const res = await db.collection('activities')
    .where(query)
    .orderBy('sortOrder', 'asc')
    .orderBy('createdAt', 'desc')
    .skip(skip)
    .limit(limit)
    .get();
    
  return { data: res.data, total: res.data.length };
};
```

---

### 2. getActivityDetail
```javascript
// 获取活动详情
exports.main = async (event, context) => {
  const { activityId } = event;
  const db = cloud.database();
  
  // 获取活动信息
  const activity = await db.collection('activities')
    .doc(activityId)
    .get();
    
  if (!activity.data) {
    return { error: '活动不存在' };
  }
  
  // 增加浏览次数
  await db.collection('activities')
    .doc(activityId)
    .update({
      data: {
        viewCount: db.command.inc(1)
      }
    });
    
  // 获取摄影师信息
  const photographers = await db.collection('photographers')
    .where({
      _id: db.command.in(activity.data.photographerIds)
    })
    .get();
    
  return {
    activity: activity.data,
    photographers: photographers.data
  };
};
```

---

### 3. createActivityOrder
```javascript
// 创建活动订单
exports.main = async (event, context) => {
  const wxContext = cloud.getWXContext();
  const db = cloud.database();
  
  const {
    activityId,
    childName,
    childGender,
    childAge,
    childPhoto,
    parentName,
    parentPhone,
    parentWechat,
    expectations,
    photographerId
  } = event;
  
  // 获取活动信息
  const activity = await db.collection('activities').doc(activityId).get();
  
  if (!activity.data || activity.data.status !== 'active') {
    return { error: '活动不存在或已下架' };
  }
  
  // 获取摄影师信息
  const photographer = await db.collection('photographers').doc(photographerId).get();
  
  // 创建订单
  const order = await db.collection('activity_orders').add({
    data: {
      _openid: wxContext.OPENID,
      activityId,
      activityTitle: activity.data.title,
      activityCover: activity.data.coverImage,
      childName,
      childGender,
      childAge,
      childPhoto,
      parentName,
      parentPhone,
      parentWechat,
      expectations,
      photographerId,
      photographerName: photographer.data.name,
      photographerAvatar: photographer.data.avatar,
      status: 'waiting_shoot',
      price: activity.data.price,
      paymentStatus: 'pending',
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    }
  });
  
  // 更新活动订单数
  await db.collection('activities').doc(activityId).update({
    data: {
      orderCount: db.command.inc(1)
    }
  });
  
  return { orderId: order._id };
};
```

---

## 📱 用户流程

### 参与活动完整流程

```
1. 浏览首页活动
   ↓
2. 点击感兴趣的活动
   ↓
3. 查看活动详情
   ↓
4. 点击「立即参加」
   ↓
5. 填写孩子和家长信息
   ↓
6. 选择摄影师
   ↓
7. 提交订单
   ↓
8. 支付（模拟）
   ↓
9. 等待摄影师拍摄
   ↓
10. 查看订单状态
   ↓
11. 确认照片
   ↓
12. 下载照片/查看档案
```

---

## 🎯 开发优先级

### Phase 1: 数据库和云函数（当前）
- [x] 设计数据库结构
- [ ] 创建云数据库集合
- [ ] 开发云函数

### Phase 2: 后台管理
- [ ] 活动管理页面
- [ ] 活动编辑页面
- [ ] 订单管理页面

### Phase 3: 小程序前端
- [ ] 首页活动展示
- [ ] 活动详情页
- [ ] 活动报名页
- [ ] 我的订单页

### Phase 4: 流程完善
- [ ] 摄影师任务页
- [ ] 客服审核流程
- [ ] 家长确认流程
- [ ] 档案自动生成

---

## 💡 扩展性设计

### 未来可添加的活动类型
- 春游摄影活动
- 夏令营合影
- 毕业照拍摄
- 节日主题拍摄
- 家庭合影
- 才艺展示拍摄

### 未来可添加的功能
- 活动评价系统
- 摄影师评分
- 优惠券系统
- 拼团活动
- 限时秒杀
- 积分系统
- 会员系统

---

**设计完成！现在开始实施第一步：创建云数据库和云函数** 🚀

