# 🚀 订阅消息快速开始

## ✅ 我已经帮你完成的工作

### 1. 创建了完整的通知系统
- ✅ 消息通知工具类（`utils/notification.js`）
- ✅ 发送消息云函数（`cloudfunctions/sendSubscribeMessage/`）
- ✅ 包含8个通知场景

### 2. 准备好的通知场景

**用户端（6个）：**
1. 订单创建成功
2. 照片已上传待审核
3. 照片审核通过
4. 照片被拒绝
5. 订单已完成

**摄影师端（3个）：**
1. 新订单待处理
2. 照片审核通过
3. 照片被拒绝需修改

---

## 🎯 你需要做的3件事

### 第一步：在微信公众平台添加模板（最重要）

1. **登录微信公众平台**
   - 网址：https://mp.weixin.qq.com
   - 扫码登录

2. **进入订阅消息**
   - 左侧菜单：功能 → 订阅消息

3. **添加模板**
   - 点击"选用"
   - 搜索关键词：订单、审核、通知
   - 或者自己创建模板

4. **记录模板ID**
   - 每个模板有一个ID（28位字符）
   - 记录下来，下一步会用

**推荐的模板关键词：**
- "订单支付成功通知"
- "服务进度通知"
- "审核结果通知"
- "订单完成通知"

---

### 第二步：填写模板ID

**打开文件：`miniprogram/utils/notification.js`**

找到第7-19行，填入你的模板ID：

```javascript
const TEMPLATE_IDS = {
  // 把这里的空字符串替换成你的模板ID
  ORDER_CREATED: '你的模板ID',        // 订单创建成功
  PHOTO_UPLOADED: '你的模板ID',       // 照片已上传待审核
  PHOTO_APPROVED: '你的模板ID',       // 照片审核通过
  PHOTO_REJECTED: '你的模板ID',       // 照片被拒绝
  ORDER_COMPLETED: '你的模板ID',      // 订单已完成
  
  NEW_ORDER: '你的模板ID',            // 新订单待处理（摄影师）
  PHOTO_REVIEW_PASS: '你的模板ID',    // 照片审核通过（摄影师）
  PHOTO_REVIEW_REJECT: '你的模板ID',  // 照片被拒绝（摄影师）
};
```

---

### 第三步：上传云函数

**在微信开发者工具中：**

1. 找到 `cloudfunctions/sendSubscribeMessage` 文件夹
2. 右键点击
3. 选择：**"上传并部署：云端安装依赖"**
4. 等待上传完成（1-2分钟）

---

## 🎉 完成！

配置完成后，系统会在以下时机自动发送通知：

- ✅ 用户下单后 → 发送订单创建通知
- ✅ 摄影师上传照片 → 通知用户查看
- ✅ 管理员审核 → 通知审核结果
- ✅ 用户确认 → 发送订单完成通知

---

## 🧪 如何测试

### 1. 测试授权

在小程序中下单时，会弹出订阅消息授权：
```
次元学校想给你发送通知
- 订单支付成功通知
- 服务进度通知
- 审核结果通知

[总是允许] [允许] [拒绝]
```

### 2. 测试接收

完成一个订单流程，查看是否收到消息：
1. 下单 → 收到"订单创建成功"
2. 摄影师上传 → 收到"照片已上传"
3. 管理员审核 → 收到"审核结果"
4. 确认完成 → 收到"订单完成"

---

## ❓ 常见问题

### Q: 模板ID在哪里找？

**A:** 微信公众平台 → 功能 → 订阅消息 → 我的模板 → 点击模板查看详情

### Q: 用户没收到消息？

**A:** 检查：
1. 用户是否授权了订阅消息
2. 模板ID是否填写正确
3. 云函数是否上传成功

### Q: 需要配置所有8个模板吗？

**A:** 不需要！可以先配置最重要的几个：
- 订单创建成功（必须）
- 照片已上传（必须）
- 审核结果（必须）
- 其他可以后续添加

---

## 📚 详细文档

如需更详细的说明，请查看：
- `订阅消息配置指南.md` - 完整配置步骤
- `utils/notification.js` - 代码实现

---

**有问题随时告诉我！** 🚀
