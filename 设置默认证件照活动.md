# 设置默认证件照活动 📸

## 🎯 目的

确保自动创建学生档案功能正常工作，需要设置一个默认的证件照活动。

---

## 📋 操作步骤

### 步骤 1: 打开云开发控制台

1. 微信开发者工具
2. 点击顶部**"云开发"**按钮
3. 选择**"数据库"**选项卡

### 步骤 2: 找到证件照活动

1. 点击 `activities` 集合
2. 找到 `_id` 为 `43d365dc68ee129202af48e635a3651e` 的记录
   - 或者找到 `category` 字段值为 `证件照` 的活动

### 步骤 3: 编辑活动

点击这条记录的**编辑按钮**（铅笔图标）

### 步骤 4: 设置必要字段

确保以下字段存在且正确：

```json
{
  "_id": "43d365dc68ee129202af48e635a3651e",
  "name": "证件照拍摄",
  "category": "证件照",
  "description": "专业证件照拍摄服务",
  "coverImage": "cloud://...",
  "price": 20,
  "isDefault": true,
  "status": "active",
  "createdAt": "2025-10-15T00:00:00.000Z",
  "updatedAt": "2025-10-15T00:00:00.000Z"
}
```

**重要字段说明：**
- `name`: 活动名称，显示给用户看（**新增或修改**）
- `category`: 必须是 `证件照`（完全一致）
- `isDefault`: 设置为 `true`（**关键！**）
- `status`: 设置为 `active`（启用状态）

### 步骤 5: 保存

点击**"确定"**保存修改

---

## ✅ 验证设置

### 方法 1: 运行云函数测试

1. 云开发 → 云函数 → `fixOrderActivityId`
2. 点击"测试"，参数留空 `{}`
3. 查看返回结果：

```json
{
  "success": true,
  "✅ 找到证件照活动: 证件照拍摄 (_id: xxx )",
  "   是否默认活动: 是"
}
```

如果看到 **"是"**，说明设置成功！

### 方法 2: 创建新订单测试

1. 刷新小程序
2. 创建新订单
3. 查看控制台日志：

```
✅ 使用证件照活动: 43d365dc68ee129202af48e635a3651e
```

4. 摄影师上传照片
5. 确认收货
6. 应该看到：

```
📋 检查是否需要创建学生档案...
   活动类别: 证件照
   学生姓名: xxx
✅ 这是证件照订单，开始创建学生档案...
✅ 生成学号: 0003
✅ 学生档案创建成功！学号: 0003
```

---

## 🖼️ 添加活动封面图（可选）

如果你想让档案上显示活动图片，需要上传封面图：

### 方法 1: 使用云存储

1. 云开发 → 存储 → 上传文件
2. 上传一张证件照样例图片
3. 复制文件链接（`cloud://...`）
4. 粘贴到活动的 `coverImage` 字段

### 方法 2: 使用 HTTP 图片

直接在 `coverImage` 字段填入图片URL：

```
https://example.com/id-photo-sample.jpg
```

---

## 📊 数据库完整示例

```json
{
  "_id": "43d365dc68ee129202af48e635a3651e",
  "_openid": "o5_xU4wY1pz-JxOi8XdAX_O0bbHw",
  "name": "证件照拍摄",
  "category": "证件照",
  "description": "专业一寸、二寸证件照拍摄，包含电子版和打印版",
  "coverImage": "cloud://cloud1-9gdsq5jxb7e60ab4.636c-cloud1-9gdsq5jxb7e60ab4-1382624595/activities/id-photo-sample.jpg",
  "images": [],
  "price": 20,
  "isDefault": true,
  "status": "active",
  "views": 0,
  "createdAt": "2025-10-14T09:06:26.337Z",
  "updatedAt": "2025-10-15T04:00:00.000Z"
}
```

---

## ⚠️ 注意事项

### 1. 只能有一个默认活动

如果有多个证件照活动，只有一个应该设置 `isDefault: true`。

### 2. category 必须完全匹配

`category` 必须是 `证件照`，不能是：
- ❌ `证件照拍摄`
- ❌ `ID照`
- ❌ `证 件 照`（有空格）

### 3. 状态必须是 active

`status` 应该是 `active`，不要是 `inactive` 或 `draft`。

---

## 🔍 常见问题

### Q1: 如果没有 isDefault 字段怎么办？

**A:** 手动添加：
1. 编辑活动记录
2. 点击"添加字段"
3. 字段名：`isDefault`
4. 类型：Boolean
5. 值：`true`

### Q2: 如果有多个证件照活动怎么办？

**A:** 选择一个设置为默认，其他的 `isDefault` 设置为 `false` 或删除该字段。

### Q3: 活动的 name 字段是 undefined 怎么办？

**A:** 添加 name 字段：
```json
{
  "name": "证件照拍摄"
}
```

---

## 🎉 完成后

设置完成后，请：

1. ✅ 刷新小程序（编译）
2. ✅ 创建新订单测试
3. ✅ 确认收货
4. ✅ 查看"我的孩子"页面，应该出现新档案

如果还有问题，请查看控制台日志并告诉我！

---

最后更新：2025-10-15

