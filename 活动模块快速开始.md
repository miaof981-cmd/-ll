# 🚀 活动模块快速开始指南

## 📋 前置准备

### 1. 云数据库集合创建

登录微信公众平台 → 云开发 → 数据库 → 添加集合

需要创建以下集合：
- ✅ `activities` - 活动集合
- ✅ `activity_orders` - 活动订单集合

---

### 2. 云函数上传

在微信开发者工具中：

1. **右键** `cloudfunctions/getActivities` → **上传并部署：云端安装依赖**
2. **右键** `cloudfunctions/getActivityDetail` → **上传并部署：云端安装依赖**
3. **右键** `cloudfunctions/createActivityOrder` → **上传并部署：云端安装依赖**

等待上传完成（每个约30秒）

---

## 🎯 快速测试

### Step 1: 创建测试活动

在云数据库 `activities` 集合中添加测试数据：

```javascript
{
  "title": "校园证件照拍摄",
  "subtitle": "专业证件照，一寸/两寸可选",
  "coverImage": "cloud://你的图片fileID",
  "images": [
    "cloud://图片1",
    "cloud://图片2"
  ],
  "description": "专业摄影师为您拍摄标准证件照，包含精修、底片等服务。",
  "details": "【服务内容】\n✅ 专业摄影师拍摄\n✅ 5张精修照片\n✅ 电子底片\n✅ 一寸/两寸可选",
  "price": 20,
  "originalPrice": 30,
  "photographerIds": [
    "你的摄影师_id_1",
    "你的摄影师_id_2"
  ],
  "tags": ["证件照", "必备", "热门"],
  "category": "证件照",
  "status": "active",
  "isHot": true,
  "isNew": false,
  "viewCount": 0,
  "orderCount": 0,
  "sortOrder": 1,
  "createdAt": "2025-10-14T12:00:00.000Z",
  "updatedAt": "2025-10-14T12:00:00.000Z"
}
```

---

### Step 2: 准备摄影师数据

确保 `photographers` 集合中有摄影师数据：

```javascript
{
  "name": "李老师",
  "avatar": "cloud://头像fileID",
  "rating": 4.9,
  "bio": "10年摄影经验",
  "phone": "13800138000",
  "createdAt": "2025-10-14T12:00:00.000Z"
}
```

---

### Step 3: 上传测试图片

1. 打开云开发控制台 → 云存储
2. 创建文件夹：`activities`
3. 上传活动封面图和展示图
4. 复制图片的 `fileID`
5. 更新活动数据中的 `coverImage` 和 `images`

---

### Step 4: 编译运行

1. 点击开发者工具的"编译"按钮
2. 查看控制台输出：
   ```
   ✅ 云开发初始化成功，环境ID: cloud1-xxx
   ✅ 轮播图数量: X
   ✅ 公告数量: X
   ✅ 活动数量: 1
   ```

---

## 🧪 功能测试流程

### 测试1：首页活动展示

1. 打开小程序首页
2. 向下滚动到"全部活动"区域
3. 查看活动卡片是否正常显示
4. 点击分类标签，查看筛选是否生效

**预期结果：**
- ✅ 活动卡片显示封面图、标题、价格
- ✅ 热门/新品标签正常显示
- ✅ 分类筛选功能正常

---

### 测试2：活动详情页

1. 点击任意活动卡片
2. 进入活动详情页
3. 查看图片轮播是否正常
4. 向下滚动查看活动介绍
5. 查看摄影师列表

**预期结果：**
- ✅ 图片轮播正常
- ✅ 活动信息完整显示
- ✅ 摄影师列表正常显示
- ✅ 浏览次数自动增加

---

### 测试3：活动报名

1. 点击"立即参加"按钮
2. 填写表单：
   - 孩子姓名：测试小朋友
   - 性别：选择男/女
   - 年龄：8
   - 生活照：点击上传
   - 家长姓名：张女士
   - 手机号：13800138000
   - 微信号：test123
   - 期望：测试期望
   - 选择摄影师
3. 点击"提交订单"

**预期结果：**
- ✅ 图片上传成功（显示预览）
- ✅ 表单验证正常（手机号格式）
- ✅ 摄影师选择有选中状态
- ✅ 提交成功提示

---

### 测试4：查看订单数据

1. 打开云开发控制台
2. 进入数据库 → `activity_orders` 集合
3. 查看是否有新订单记录

**预期数据：**
```javascript
{
  "_openid": "xxx",
  "activityId": "活动ID",
  "activityTitle": "校园证件照拍摄",
  "childName": "测试小朋友",
  "childGender": "男",
  "childPhoto": "cloud://xxx.jpg",
  "parentName": "张女士",
  "parentPhone": "13800138000",
  "photographerId": "摄影师ID",
  "status": "waiting_shoot",
  "price": 20,
  "paymentStatus": "paid",
  "createdAt": "2025-10-14..."
}
```

---

## 🐛 常见问题

### Q1: 活动列表为空

**原因：**
- 云函数未上传
- `activities` 集合为空
- 活动 `status` 不是 `active`

**解决：**
1. 检查云函数是否上传成功
2. 在数据库中添加测试活动
3. 确保 `status: "active"`

---

### Q2: 图片显示失败

**原因：**
- fileID 格式错误
- 云存储权限未配置
- 图片文件不存在

**解决：**
1. 检查 `coverImage` 是否是正确的 `cloud://` 格式
2. 确认云存储中文件存在
3. 检查云存储权限配置

---

### Q3: 云函数调用失败

**错误：**
```
errCode: -502005 cloud function not exists
```

**解决：**
1. 确认云函数已上传
2. 检查云函数名称是否正确
3. 等待云函数部署完成（约30秒）

---

### Q4: 订单提交失败

**错误：**
```
❌ 创建订单失败: Error: xxx
```

**解决：**
1. 检查表单是否填写完整
2. 确认摄影师ID是否有效
3. 查看控制台详细错误信息
4. 检查云函数 `createActivityOrder` 是否正常

---

### Q5: 浏览次数不增加

**原因：**
- 云函数 `getActivityDetail` 未正确执行
- 数据库权限问题

**解决：**
1. 检查云函数日志
2. 确认数据库写权限
3. 重新上传云函数

---

## 📊 数据库权限配置

### activities 集合权限

```json
{
  "read": true,
  "write": "auth.openid == doc._openid"
}
```

### activity_orders 集合权限

```json
{
  "read": "auth.openid == doc._openid",
  "write": "auth.openid == doc._openid"
}
```

---

## 🎨 自定义活动

### 创建新活动

1. 打开云数据库 → `activities`
2. 点击"添加记录"
3. 填写以下字段：

**必填字段：**
- `title` - 活动标题
- `subtitle` - 副标题
- `coverImage` - 封面图（cloud:// 格式）
- `description` - 简介
- `price` - 价格
- `category` - 分类
- `status` - 状态（active/inactive）

**选填字段：**
- `originalPrice` - 原价
- `images` - 详情图片数组
- `details` - 详细说明
- `photographerIds` - 摄影师ID数组
- `tags` - 标签数组
- `isHot` - 是否热门
- `isNew` - 是否新品
- `sortOrder` - 排序（数字越小越靠前）

---

## 🔧 调试技巧

### 1. 查看云函数日志

登录云开发控制台 → 云函数 → 选择函数 → 日志

### 2. 控制台输出

在小程序中查看 Console：
```
✅ 云端获取活动成功: 3
✅ 云端获取活动详情成功
✅ 云端创建订单成功
```

### 3. 网络请求

开发者工具 → Network 标签 → 查看云函数调用

---

## 📝 下一步

完成测试后，可以继续开发：

1. **后台管理页面** - 方便管理活动
2. **订单管理系统** - 查看和处理订单
3. **摄影师任务页** - 摄影师查看任务
4. **客服审核功能** - 审核作品
5. **家长订单页** - 查看订单状态

---

## ✅ 测试检查清单

- [ ] 云数据库集合已创建
- [ ] 云函数已上传
- [ ] 测试活动已添加
- [ ] 测试图片已上传
- [ ] 摄影师数据已准备
- [ ] 首页活动展示正常
- [ ] 分类筛选功能正常
- [ ] 详情页显示正常
- [ ] 图片轮播正常
- [ ] 报名表单验证正常
- [ ] 图片上传成功
- [ ] 订单创建成功
- [ ] 数据库记录正确

---

**全部测试通过后，活动模块前端功能即可使用！** 🎉

下一步：开发后台管理系统

