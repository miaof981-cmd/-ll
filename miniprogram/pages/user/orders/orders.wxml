<view class="orders-page">
  <!-- é¡¶éƒ¨æ  -->
  <view class="top-bar">
    <view class="page-title">æˆ‘çš„è®¢å•</view>
  </view>

  <!-- çŠ¶æ€ç­›é€‰ -->
  <scroll-view class="status-filter" scroll-x>
    <view class="filter-tabs">
      <view
        wx:for="{{statusFilters}}"
        wx:key="id"
        class="filter-tab {{activeStatus === item.id ? 'active' : ''}}"
        bindtap="switchStatus"
        data-status="{{item.id}}"
      >
        {{item.name}}
      </view>
    </view>
  </scroll-view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="orders-list">
    <view wx:if="{{loading}}" class="loading-tip">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <view wx:elif="{{filteredOrders.length === 0}}" class="empty-tip">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— è®¢å•</text>
      <view class="empty-btn" bindtap="goActivities">å»çœ‹çœ‹æ´»åŠ¨</view>
    </view>

    <view
      wx:for="{{filteredOrders}}"
      wx:key="_id"
      class="order-card"
      bindtap="viewOrder"
      data-id="{{item._id}}"
    >
      <!-- è®¢å•çŠ¶æ€ -->
      <view class="order-header">
        <view class="order-time">{{item.createdAt}}</view>
        <view class="order-status" style="color: {{item.statusColor}}">
          {{item.statusIcon}} {{item.statusText}}
        </view>
      </view>

      <!-- æ´»åŠ¨ä¿¡æ¯ -->
      <view class="order-content">
        <image 
          wx:if="{{item.activityInfo}}" 
          class="activity-cover" 
          src="{{item.activityInfo.coverImage}}" 
          mode="aspectFill"
        ></image>
        <view class="order-info">
          <text class="activity-title">{{item.activityInfo ? item.activityInfo.title : 'æ´»åŠ¨å·²åˆ é™¤'}}</text>
          <text wx:if="{{item.photographerInfo}}" class="photographer-name">
            ğŸ“· {{item.photographerInfo.name}}
          </text>
          <text class="order-price">Â¥{{item.totalPrice}}</text>
        </view>
      </view>

      <!-- æ‘„å½±å¸ˆä½œå“é¢„è§ˆ -->
      <view wx:if="{{item.photos && item.photos.length > 0}}" class="order-photos">
        <view class="photos-preview">
          <image
            wx:for="{{item.photos}}"
            wx:key="index"
            wx:if="{{index < 3}}"
            class="photo-thumb"
            src="{{item}}"
            mode="aspectFill"
          ></image>
          <view wx:if="{{item.photos.length > 3}}" class="more-photos">
            <text>+{{item.photos.length - 3}}</text>
          </view>
        </view>
        <text class="photos-count">å…±{{item.photos.length}}å¼ ä½œå“</text>
      </view>

      <!-- å¾…ç¡®è®¤æç¤º -->
      <view wx:if="{{item.status === 'pending_confirm'}}" class="pending-confirm-tip">
        <text class="tip-icon">ğŸ’¡</text>
        <text class="tip-text">æ‘„å½±å¸ˆå·²æäº¤ä½œå“ï¼Œè¯·æŸ¥çœ‹å¹¶ç¡®è®¤</text>
      </view>

      <!-- è®¢å•æ“ä½œ -->
      <view class="order-actions" catchtap>
        <!-- å¾…ç¡®è®¤çŠ¶æ€ï¼šæ˜¾ç¤ºç‰¹æ®ŠæŒ‰é’® -->
        <view wx:if="{{item.status === 'pending_confirm'}}" class="confirm-actions-inline">
          <view class="action-btn reject-action" bindtap="rejectOrder" data-id="{{item._id}}" catchtap>
            âŒ æ‹’ç»
          </view>
          <view class="action-btn confirm-action" bindtap="confirmOrder" data-id="{{item._id}}" catchtap>
            âœ… ç¡®è®¤
          </view>
        </view>
        
        <!-- å…¶ä»–çŠ¶æ€ï¼šæ˜¾ç¤ºåŸæœ‰æŒ‰é’® -->
        <view wx:elif="{{item.userActions && item.userActions.length > 0}}" class="normal-actions">
          <view
            wx:for="{{item.userActions}}"
            wx:key="index"
            wx:for-item="action"
            class="action-btn action-{{action}}"
            bindtap="handleAction"
            data-id="{{item._id}}"
            data-action="{{action}}"
            catchtap
          >
            {{getActionText(action)}}
          </view>
        </view>
      </view>
    </view>
  </view>
</view>

