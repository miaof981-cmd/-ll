<view class="container">
  <view class="form">
    <view class="form-item">
      <text class="label">摄影师姓名 *</text>
      <input class="input" placeholder="请输入姓名" value="{{name}}" bindinput="onNameInput" />
    </view>

    <view class="form-item">
      <text class="label">专长风格</text>
      <input class="input" placeholder="如：星空风格、清新自然" value="{{specialty}}" bindinput="onSpecialtyInput" />
    </view>

    <view class="form-item">
      <text class="label">简介</text>
      <textarea class="textarea" placeholder="请输入简介" value="{{description}}" bindinput="onDescriptionInput" maxlength="200"></textarea>
    </view>

    <view class="form-item">
      <view class="label-with-help">
        <text class="label">微信绑定</text>
        <text class="help-icon" bindtap="showOpenidHelp">❓</text>
      </view>
      
      <!-- 绑定方式选择 -->
      <view class="bind-options">
        <view class="bind-option" bindtap="manualInputOpenid">
          <view class="option-icon">⌨️</view>
          <view class="option-content">
            <text class="option-title">绑定微信账号</text>
            <text class="option-desc">输入摄影师的OpenID</text>
          </view>
          <text class="option-arrow">→</text>
        </view>
      </view>
      
      <!-- 已绑定的OpenID显示 -->
      <view wx:if="{{wechatOpenid}}" class="bound-openid">
        <text class="bound-label">已绑定:</text>
        <text class="bound-value">{{wechatOpenid}}</text>
        <text class="unbind-btn" bindtap="unbindOpenid">解绑</text>
      </view>
      
      <view class="hint">💡 绑定后该用户登录小程序即可自动获得摄影师权限</view>
    </view>

    <view class="form-item">
      <text class="label">头像</text>
      <view class="image-upload">
        <image class="preview" src="{{avatar}}" mode="aspectFill" wx:if="{{avatar}}" bindtap="previewAvatar"></image>
        <view class="upload-btn" bindtap="uploadAvatar" wx:else>
          <text>+</text>
        </view>
      </view>
    </view>

    <view class="form-item">
      <text class="label">参考作品（最多9张）</text>
      <view class="reference-images">
        <view 
          wx:for="{{referenceImages}}" 
          wx:key="index" 
          class="ref-image-item"
        >
          <image class="ref-image" src="{{item}}" mode="aspectFill" bindtap="previewReferenceImage" data-index="{{index}}"></image>
          <view class="delete-btn" bindtap="deleteReferenceImage" data-index="{{index}}">✕</view>
        </view>
        <view wx:if="{{referenceImages.length < 9}}" class="upload-btn-small" bindtap="uploadReferenceImage">
          <text>+</text>
        </view>
      </view>
      <view class="hint">💡 展示摄影师的作品风格，帮助家长选择</view>
    </view>

    <!-- 参与活动总览与编辑 -->
    <view class="form-item">
      <text class="label">参与活动</text>
      <button class="btn-select" bindtap="openActivityPicker">配置参与活动（已选{{selectedActivityIds.length}}个）</button>
      <view wx:if="{{selectedActivities.length > 0}}" class="chips">
        <view wx:for="{{selectedActivities}}" wx:key="_id" class="chip">{{item.title}}</view>
      </view>
    </view>

    <view class="form-actions">
      <button class="btn-cancel" bindtap="cancel">取消</button>
      <button class="btn-save" bindtap="save">保存</button>
    </view>
  </view>
  <!-- 活动多选弹层 -->
  <view wx:if="{{showActivityPicker}}" class="picker-mask" bindtap="closeActivityPicker"></view>
  <view wx:if="{{showActivityPicker}}" class="picker-panel" catchtouchmove>
    <view class="picker-header">
      <text class="picker-title">选择参与的活动</text>
      <view class="picker-actions">
        <button class="picker-btn" bindtap="toggleSelectAllActivities">{{isAllActivitySelected ? '全不选' : '全选'}}</button>
        <button class="picker-btn primary" bindtap="confirmActivityPicker">确定</button>
      </view>
    </view>
    <view class="picker-search">
      <input class="search-input" placeholder="搜索活动标题" value="{{activityKeyword}}" bindinput="onActivitySearch" />
    </view>
    <scroll-view class="picker-list" scroll-y>
      <view wx:for="{{filteredActivities}}" wx:key="_id" class="picker-item" bindtap="toggleActivity" data-id="{{item._id}}">
        <image wx:if="{{item.coverImage}}" class="picker-avatar" src="{{item.coverImage}}" mode="aspectFill" />
        <view wx:else class="picker-avatar placeholder">图</view>
        <view class="picker-info">
          <text class="picker-name">{{item.title}}</text>
          <text class="picker-sub">¥{{item.price}}</text>
        </view>
        <view class="picker-check">{{ tempSelectedActivityIds.includes(item._id) ? '✓' : ''}}</view>
      </view>
      <view wx:if="{{hasMoreActivities}}" class="picker-loadmore" bindtap="loadMoreActivities">加载更多</view>
    </scroll-view>
  </view>

  <!-- OpenID 帮助弹窗 -->
  <view wx:if="{{showOpenidHelp}}" class="modal-mask" bindtap="hideOpenidHelp">
    <view class="modal-content" catchtap>
      <view class="modal-header">
        <text class="modal-title">如何获取微信 OpenID？</text>
        <text class="modal-close" bindtap="hideOpenidHelp">✕</text>
      </view>
      <view class="modal-body">
        <view class="step-item">
          <text class="step-num">1</text>
          <text class="step-text">让该摄影师先使用微信登录小程序</text>
        </view>
        <view class="step-item">
          <text class="step-num">2</text>
          <text class="step-text">摄影师进入「我的」页面</text>
        </view>
        <view class="step-item">
          <text class="step-num">3</text>
          <text class="step-text">在用户卡片中可以看到并复制 OpenID</text>
        </view>
        <view class="step-item">
          <text class="step-num">4</text>
          <text class="step-text">将复制的 OpenID 粘贴到这里</text>
        </view>
        <view class="step-note">
          💡 绑定后，该用户下次登录小程序时会自动识别为摄影师身份
        </view>
      </view>
      <button class="modal-btn" bindtap="hideOpenidHelp">我知道了</button>
    </view>
  </view>
</view>

