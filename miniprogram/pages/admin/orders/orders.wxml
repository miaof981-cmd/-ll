<view class="orders-page">
  <!-- é¡¶éƒ¨æ  -->
  <view class="top-bar">
    <view class="page-title">è®¢å•ç®¡ç†</view>
    <view class="order-count">å…± {{orders.length}} å•</view>
  </view>

  <!-- çŠ¶æ€ç­›é€‰ -->
  <scroll-view class="status-filter" scroll-x>
    <view class="filter-tabs">
      <view
        wx:for="{{statusFilters}}"
        wx:key="id"
        class="filter-tab {{activeStatus === item.id ? 'active' : ''}}"
        bindtap="switchStatus"
        data-status="{{item.id}}"
      >
        {{item.name}}
      </view>
    </view>
  </scroll-view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="orders-list">
    <view wx:if="{{loading}}" class="loading-tip">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <view wx:elif="{{filteredOrders.length === 0}}" class="empty-tip">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— è®¢å•</text>
    </view>

    <view
      wx:for="{{filteredOrders}}"
      wx:key="_id"
      class="order-card"
      bindtap="viewOrder"
      data-id="{{item._id}}"
    >
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="order-number">è®¢å•å·: {{item.orderNo || item._id.slice(-8)}}</view>
        <view class="order-status" style="color: {{item.statusColor}}">
          {{item.statusIcon}} {{item.statusText}}
        </view>
      </view>

      <!-- æ´»åŠ¨ä¿¡æ¯ -->
      <view class="order-content">
        <image wx:if="{{item.activityInfo}}" class="activity-cover" src="{{item.activityInfo.coverImage}}" mode="aspectFill"></image>
        <view class="order-info">
          <text class="activity-title">{{item.activityInfo ? item.activityInfo.title : 'æ´»åŠ¨å·²åˆ é™¤'}}</text>
          <text class="user-name">ç”¨æˆ·: {{item.userInfo ? item.userInfo.nickName : item._openid.slice(-6)}}</text>
          <text class="order-time">{{item.createdAt || ''}}</text>
        </view>
        <view class="order-price">Â¥{{item.totalPrice}}</view>
      </view>

      <!-- è®¢å•æ“ä½œ -->
      <view wx:if="{{item.adminActions && item.adminActions.length > 0}}" class="order-actions" catchtap>
        <view
          wx:for="{{item.adminActions}}"
          wx:key="index"
          wx:for-item="action"
          class="action-btn action-{{action}}"
          bindtap="handleAction"
          data-id="{{item._id}}"
          data-action="{{action}}"
          catchtap
        >
          {{action === 'start' ? 'å¼€å§‹æ‹æ‘„' : action === 'complete' ? 'æ ‡è®°å®Œæˆ' : action === 'refund' ? 'åŒæ„é€€æ¬¾' : action === 'reject' ? 'æ‹’ç»å”®å' : action === 'cancel' ? 'å–æ¶ˆè®¢å•' : action}}
        </view>
      </view>
    </view>
  </view>
</view>

