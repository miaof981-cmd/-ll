<!--pages/admin/students/edit.wxml-->
<view class="container">
  <view class="form-section">
    <!-- 证件照（最上面） -->
    <view class="photo-section-edit">
      <view class="photo-upload" bindtap="uploadAvatar">
        <image 
          wx:if="{{formData.avatar}}" 
          class="photo-preview" 
          src="{{formData.avatar}}" 
          mode="aspectFit"
        />
        <view wx:else class="photo-placeholder">
          <text class="upload-icon">📷</text>
          <text class="upload-text">点击上传证件照</text>
        </view>
      </view>
    </view>

    <!-- 基本信息 -->
    <view class="section-title">基本信息</view>
    
    <view class="form-group">
      <text class="form-label">学号</text>
      <view class="form-value-readonly">{{studentId || '保存后自动生成'}}</view>
    </view>

    <view class="form-group">
      <text class="form-label">姓名 *</text>
      <input 
        class="form-input" 
        placeholder="请输入学生姓名" 
        value="{{formData.name}}"
        bindinput="onNameInput"
      />
    </view>

    <view class="form-group">
      <text class="form-label">性别 *</text>
      <view class="radio-group">
        <view class="radio-item" bindtap="selectGender" data-gender="男">
          <view class="radio {{formData.gender === '男' ? 'checked' : ''}}"></view>
          <text>男</text>
        </view>
        <view class="radio-item" bindtap="selectGender" data-gender="女">
          <view class="radio {{formData.gender === '女' ? 'checked' : ''}}"></view>
          <text>女</text>
        </view>
      </view>
    </view>

    <view class="form-group">
      <text class="form-label">年龄 *</text>
      <input 
        class="form-input" 
        type="number"
        placeholder="请输入年龄" 
        value="{{formData.age}}"
        bindinput="onAgeInput"
      />
    </view>

    <!-- 家长信息 -->
    <view class="section-title">家长信息</view>

    <view class="form-group">
      <text class="form-label">家长姓名 *</text>
      <input 
        class="form-input" 
        placeholder="请输入家长姓名" 
        value="{{formData.parentName}}"
        bindinput="onParentNameInput"
      />
    </view>

    <view class="form-group">
      <text class="form-label">联系电话 *</text>
      <input 
        class="form-input" 
        type="number"
        placeholder="请输入联系电话" 
        value="{{formData.parentPhone}}"
        bindinput="onParentPhoneInput"
      />
    </view>

    <view class="form-group">
      <text class="form-label">联系微信</text>
      <input 
        class="form-input" 
        placeholder="请输入微信号" 
        value="{{formData.parentWechat}}"
        bindinput="onParentWechatInput"
      />
    </view>

    <!-- 家长期许 -->
    <view class="section-title">家长期许</view>

    <view class="form-group">
      <textarea 
        class="form-textarea" 
        placeholder="请输入对孩子的期许" 
        value="{{formData.expectations}}"
        bindinput="onExpectationsInput"
        maxlength="200"
      />
    </view>

    <!-- 初始档案（仅新建时） -->
    <view wx:if="{{!isEdit}}" class="records-section">
      <view class="section-title">
        <text>初始档案（可选）</text>
        <button class="btn-add-record" bindtap="addRecord">
          + 添加档案
        </button>
      </view>

      <view wx:if="{{initRecords.length === 0}}" class="empty-hint">
        <text>暂无档案，可点击上方按钮添加</text>
      </view>

      <!-- 档案列表 -->
      <view 
        wx:for="{{initRecords}}" 
        wx:key="tempId" 
        class="record-item"
      >
        <view class="record-header">
          <text class="record-type">
            {{item.type === 'grade' ? '📊 成绩单' : item.type === 'image' ? '🖼️ 图片档案' : '⚠️ 处分单'}}
          </text>
          <view class="btn-delete-record" bindtap="deleteRecord" data-index="{{index}}">
            删除
          </view>
        </view>

        <!-- 成绩单表单 -->
        <view wx:if="{{item.type === 'grade'}}" class="record-form">
          <input 
            class="mini-input" 
            placeholder="学期" 
            data-index="{{index}}" 
            data-field="term"
            bindinput="setRecordField"
          />
          <input 
            class="mini-input" 
            type="number" 
            placeholder="语文" 
            data-index="{{index}}" 
            data-field="chinese"
            bindinput="setRecordField"
          />
          <input 
            class="mini-input" 
            type="number" 
            placeholder="数学" 
            data-index="{{index}}" 
            data-field="math"
            bindinput="setRecordField"
          />
          <input 
            class="mini-input" 
            type="number" 
            placeholder="英语" 
            data-index="{{index}}" 
            data-field="english"
            bindinput="setRecordField"
          />
        </view>

        <!-- 图片档案表单 -->
        <view wx:if="{{item.type === 'image'}}" class="record-form">
          <input 
            class="mini-input" 
            placeholder="标题" 
            data-index="{{index}}" 
            data-field="title"
            bindinput="setRecordField"
          />
          <textarea 
            class="mini-textarea" 
            placeholder="描述" 
            data-index="{{index}}" 
            data-field="description"
            bindinput="setRecordField"
          />
          <view class="mini-upload" bindtap="uploadRecordImage" data-index="{{index}}">
            <image 
              wx:if="{{item.data.imageUrl}}" 
              class="mini-preview" 
              src="{{item.data.imageUrl}}" 
              mode="widthFix"
            />
            <text wx:else>点击上传图片</text>
          </view>
        </view>

        <!-- 处分单表单 -->
        <view wx:if="{{item.type === 'punishment'}}" class="record-form">
          <input 
            class="mini-input" 
            placeholder="处分类型" 
            data-index="{{index}}" 
            data-field="type"
            bindinput="setRecordField"
          />
          <textarea 
            class="mini-textarea" 
            placeholder="处分原因" 
            data-index="{{index}}" 
            data-field="reason"
            bindinput="setRecordField"
          />
        </view>
      </view>
    </view>
  </view>

  <!-- 保存按钮 -->
  <view class="footer">
    <button class="btn-save" bindtap="saveStudent">
      {{isEdit ? '保存修改' : '创建学生'}}
    </button>
  </view>
</view>
