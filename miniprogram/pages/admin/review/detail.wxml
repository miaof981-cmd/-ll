<view class="review-detail-page">
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <view wx:else>
    <!-- æ´»åŠ¨å‚è€ƒä¿¡æ¯ -->
    <view class="reference-section" wx:if="{{activity}}">
      <view class="section-header">
        <text class="section-icon">ğŸ¯</text>
        <text class="section-title">æ´»åŠ¨å‚è€ƒ</text>
        <text class="section-subtitle">å¯¹æ¯”æŸ¥çœ‹ä½œå“æ˜¯å¦ç¬¦åˆè¦æ±‚</text>
      </view>
      
      <view class="activity-reference">
        <image 
          wx:if="{{activity.image}}"
          class="activity-cover" 
          src="{{activity.image}}" 
          mode="aspectFill"
          bindtap="previewActivityCover"
        />
        <view class="activity-details">
          <text class="activity-name">{{activity.name}}</text>
          <text class="activity-desc" wx:if="{{activity.description}}">{{activity.description}}</text>
          <text class="activity-price">å‚è€ƒä»·æ ¼ï¼šÂ¥{{activity.price}}</text>
        </view>
      </view>
    </view>

    <!-- æäº¤çš„ä½œå“ -->
    <view class="works-section">
      <view class="section-header">
        <text class="section-icon">ğŸ“¸</text>
        <text class="section-title">æäº¤ä½œå“ï¼ˆ{{order.photos.length}}å¼ ï¼‰</text>
      </view>

      <!-- æ‘„å½±å¸ˆå¤‡æ³¨ -->
      <view wx:if="{{order.photographerNote}}" class="photographer-note">
        <view class="note-label">ğŸ’¬ æ‘„å½±å¸ˆè¯´æ˜ï¼š</view>
        <text class="note-text">{{order.photographerNote}}</text>
      </view>

      <view class="photos-grid">
        <view 
          wx:for="{{order.photos}}" 
          wx:key="index"
          class="photo-item"
          bindtap="previewPhoto"
          data-index="{{index}}"
        >
          <image src="{{item}}" mode="aspectFill" class="photo" />
        </view>
      </view>
    </view>

    <!-- è®¢å•æ—¶é—´çº¿ -->
    <view class="timeline-section">
      <view class="section-header">
        <text class="section-icon">ğŸ“‹</text>
        <text class="section-title">å¤„ç†è®°å½•</text>
      </view>

      <view class="timeline">
        <!-- å½“å‰ï¼šå¾…å®¡æ ¸ -->
        <view class="timeline-item current">
          <view class="timeline-dot active"></view>
          <view class="timeline-content">
            <view class="timeline-header">
              <text class="timeline-label">ğŸ“¸ æ‘„å½±å¸ˆæäº¤ä½œå“</text>
              <text class="timeline-time">{{order.submittedAt}}</text>
            </view>
            <text class="timeline-desc">å·²æäº¤ {{order.photos.length}} å¼ ç…§ç‰‡ï¼Œç­‰å¾…å®¡æ ¸</text>
          </view>
        </view>

        <!-- å†å²è®°å½•ï¼šç®¡ç†å‘˜é©³å›æˆ–ç”¨æˆ·æ‹’ç» -->
        <block wx:for="{{historyPhotos}}" wx:key="index">
          <!-- ç®¡ç†å‘˜é©³å›è®°å½• -->
          <view wx:if="{{item.rejectType === 'admin'}}" class="timeline-item">
            <view class="timeline-dot reject"></view>
            <view class="timeline-content">
              <view class="timeline-header">
                <text class="timeline-label">ğŸš« ç®¡ç†å‘˜é©³å›</text>
                <text class="timeline-time">{{item.rejectedAt}}</text>
              </view>
              <view class="reject-reason-box admin">
                <text class="reject-label">é©³å›åŸå› ï¼š</text>
                <text class="reject-text">{{item.rejectReason}}</text>
              </view>
              <!-- æ˜¾ç¤ºè¢«æ‹’ç»çš„ç…§ç‰‡ -->
              <view wx:if="{{item.photos && item.photos.length > 0}}" class="history-photos">
                <text class="history-label">è¢«æ‹’ç»çš„ä½œå“ï¼ˆ{{item.photos.length}}å¼ ï¼‰ï¼š</text>
                <view class="history-photos-grid">
                  <image 
                    wx:for="{{item.photos}}" 
                    wx:for-item="photo" 
                    wx:for-index="photoIdx"
                    wx:key="photoIdx"
                    class="history-photo" 
                    src="{{photo}}" 
                    mode="aspectFill"
                    bindtap="previewHistoryPhoto"
                    data-photos="{{item.photos}}"
                    data-index="{{photoIdx}}"
                  />
                </view>
              </view>
            </view>
          </view>

          <!-- ç”¨æˆ·æ‹’ç»è®°å½• -->
          <view wx:elif="{{item.rejectType === 'user'}}" class="timeline-item">
            <view class="timeline-dot reject"></view>
            <view class="timeline-content">
              <view class="timeline-header">
                <text class="timeline-label">ğŸ’¬ ç”¨æˆ·è¦æ±‚ä¿®æ”¹</text>
                <text class="timeline-time">{{item.rejectedAt}}</text>
              </view>
              <view class="reject-reason-box user">
                <text class="reject-label">æ‹’ç»åŸå› ï¼š</text>
                <text class="reject-text">{{item.rejectReason}}</text>
                <text class="reject-meta">ä¿®æ”¹æ¬¡æ•°ï¼š{{item.rejectCount || 0}}/3</text>
              </view>
              <!-- æ˜¾ç¤ºè¢«æ‹’ç»çš„ç…§ç‰‡ -->
              <view wx:if="{{item.photos && item.photos.length > 0}}" class="history-photos">
                <text class="history-label">è¢«æ‹’ç»çš„ä½œå“ï¼ˆ{{item.photos.length}}å¼ ï¼‰ï¼š</text>
                <view class="history-photos-grid">
                  <image 
                    wx:for="{{item.photos}}" 
                    wx:for-item="photo" 
                    wx:for-index="photoIdx"
                    wx:key="photoIdx"
                    class="history-photo" 
                    src="{{photo}}" 
                    mode="aspectFill"
                    bindtap="previewHistoryPhoto"
                    data-photos="{{item.photos}}"
                    data-index="{{photoIdx}}"
                  />
                </view>
              </view>
            </view>
          </view>
        </block>

        <!-- å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œä½†æœ‰å½“å‰çš„æ‹’ç»åŸå› ï¼Œæ˜¾ç¤ºå½“å‰æ‹’ç» -->
        <view wx:if="{{historyPhotos.length === 0 && order.adminRejectedAt}}" class="timeline-item">
          <view class="timeline-dot reject"></view>
          <view class="timeline-content">
            <view class="timeline-header">
              <text class="timeline-label">ğŸš« ç®¡ç†å‘˜é©³å›</text>
              <text class="timeline-time">{{order.adminRejectedAt}}</text>
            </view>
            <view class="reject-reason-box admin">
              <text class="reject-label">é©³å›åŸå› ï¼š</text>
              <text class="reject-text">{{order.adminRejectReason}}</text>
            </view>
          </view>
        </view>

        <!-- å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œä½†æœ‰å½“å‰ç”¨æˆ·æ‹’ç»ï¼Œæ˜¾ç¤ºå½“å‰æ‹’ç» -->
        <view wx:if="{{historyPhotos.length === 0 && order.rejectedAt}}" class="timeline-item">
          <view class="timeline-dot reject"></view>
          <view class="timeline-content">
            <view class="timeline-header">
              <text class="timeline-label">ğŸ’¬ ç”¨æˆ·è¦æ±‚ä¿®æ”¹</text>
              <text class="timeline-time">{{order.rejectedAt}}</text>
            </view>
            <view class="reject-reason-box user">
              <text class="reject-label">æ‹’ç»åŸå› ï¼š</text>
              <text class="reject-text">{{order.rejectReason}}</text>
              <text class="reject-meta">ä¿®æ”¹æ¬¡æ•°ï¼š{{order.rejectCount || 0}}/3</text>
            </view>
          </view>
        </view>

        <!-- æ‘„å½±å¸ˆæ¥å• -->
        <view class="timeline-item">
          <view class="timeline-dot"></view>
          <view class="timeline-content">
            <view class="timeline-header">
              <text class="timeline-label">ğŸ‘ æ‘„å½±å¸ˆæ¥å•</text>
            </view>
            <text class="timeline-desc">æ‘„å½±å¸ˆï¼š{{photographer.name}}</text>
          </view>
        </view>

        <!-- è®¢å•åˆ›å»º -->
        <view class="timeline-item">
          <view class="timeline-dot"></view>
          <view class="timeline-content">
            <view class="timeline-header">
              <text class="timeline-label">ğŸ“ åˆ›å»ºè®¢å•</text>
              <text class="timeline-time">{{order.createdAt}}</text>
            </view>
            <text class="timeline-desc">å­¦ç”Ÿï¼š{{order.studentName}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- è®¢å•åŸºæœ¬ä¿¡æ¯ -->
    <view class="info-section">
      <view class="info-row">
        <text class="info-label">è®¢å•å·ï¼š</text>
        <text class="info-value">{{order.orderNo}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">å­¦ç”Ÿï¼š</text>
        <text class="info-value">{{order.studentName}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">æ‘„å½±å¸ˆï¼š</text>
        <text class="info-value">{{photographer.name}}</text>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’®ï¼ˆå›ºå®šåº•éƒ¨ï¼‰ -->
    <view class="action-bar">
      <button class="action-btn approve" bindtap="approveWork">
        <text class="btn-icon">âœ“</text>
        <text class="btn-text">å®¡æ ¸é€šè¿‡</text>
      </button>
      <button class="action-btn reject" bindtap="rejectWork">
        <text class="btn-icon">âœ•</text>
        <text class="btn-text">æ‹’ç»é‡æ‹</text>
      </button>
    </view>
  </view>
</view>

