<view class="test-page">
  <view class="header">
    <text class="title">🧪 档案创建测试工具</text>
    <text class="subtitle">快速测试档案创建功能，无需完整流程</text>
  </view>

  <view class="test-buttons">
    <button class="test-btn primary" bindtap="testCreateArchive">
      🔥 测试1: 直接创建档案
    </button>
    <button class="test-btn success" bindtap="testCreatePendingOrder">
      ⏸️ 测试2: 创建待确认订单（需手动确认）
    </button>
    <button class="test-btn info" bindtap="testFullFlow">
      🎯 测试3: 完整确认流程（自动）
    </button>
    <button class="test-btn default" bindtap="testQueryArchives">
      📋 测试4: 查询所有档案
    </button>
    <button class="test-btn warning" bindtap="testCleanup">
      🗑️ 测试5: 清空测试数据
    </button>
    <button class="test-btn purple" bindtap="addLifePhotosToStudent">
      📸 测试6: 给现有学生添加生活照
    </button>
    <button class="test-btn danger" bindtap="fixOldOrdersWithLifePhotos">
      🔧 测试7: 修复旧订单添加生活照
    </button>
    <button class="test-btn info" bindtap="checkOrderReviewStatus">
      🔍 测试8: 检查订单审核状态
    </button>
    <button class="test-btn success" bindtap="manualApproveOrder">
      ✅ 测试9: 批量审核通过订单
    </button>
    <button class="test-btn warning" bindtap="checkLifePhotosIssue">
      📷 测试10: 检查参考图加载问题
    </button>
    <button class="test-btn info" bindtap="checkSpecificOrderLifePhotos">
      🔎 测试11: 检查具体订单生活照
    </button>
    <button class="test-btn danger" bindtap="cleanInvalidLifePhotos">
      🧹 测试12: 清理无效的生活照链接
    </button>
    <button class="test-btn primary" bindtap="fixWaitingShootOrders">
      🔧 测试13: 修复 waiting_shoot 状态订单
    </button>
    <button class="test-btn info" bindtap="checkActivityData">
      🔍 测试14: 检查活动数据
    </button>
    <button class="test-btn warning" bindtap="checkLatestOrders">
      📋 测试15: 检查最新订单状态
    </button>
    <button class="test-btn danger" bindtap="fixAllWaitingShootToInProgress">
      🔥 测试16: 一键修复所有待拍摄订单
    </button>
    <button class="test-btn danger" bindtap="deleteTestOrders">
      🗑️ 测试17: 删除所有测试订单
    </button>
    <button class="test-btn info" bindtap="checkActivityPhotographers">
      🔍 测试18: 检查活动和摄影师数据
    </button>
    <button class="test-btn danger" bindtap="deleteAllOrders">
      💣 测试19: 删除所有订单（危险）
    </button>
    <button class="test-btn info" bindtap="checkLatestOrderPrice">
      💰 测试20: 检查最新订单价格
    </button>
    <button class="test-btn warning" bindtap="diagnosePaymentIssue">
      🔧 测试21: 诊断支付问题（完整分析）
    </button>
    <button class="test-btn info" bindtap="checkOrderPhotos">
      📸 测试22: 检查订单photos字段
    </button>
    <button class="test-btn primary" bindtap="migrateOrderUserId">
      🔄 测试23: 迁移订单userId字段
    </button>
    <button class="test-btn success" bindtap="diagnoseOrderOwnership">
      🔍 测试24: 诊断订单归属问题
    </button>
  </view>

  <view wx:if="{{testResult}}" class="result-box">
    <view class="result-title">测试结果</view>
    <text class="result-text">{{testResult}}</text>
  </view>

  <view class="logs-container">
    <view class="logs-header">
      <text class="logs-title">控制台日志</text>
      <button class="clear-btn" bindtap="clearLogs">清空</button>
    </view>
    <scroll-view class="logs-scroll" scroll-y>
      <view wx:for="{{logs}}" wx:key="index" class="log-item">
        {{item}}
      </view>
      <view wx:if="{{logs.length === 0}}" class="no-logs">
        暂无日志
      </view>
    </scroll-view>
  </view>

  <view class="tips">
    <view class="tip-title">💡 使用说明</view>
    <view class="tip-item">• 测试1：直接创建一个档案，测试写入权限</view>
    <view class="tip-item">• 测试2：创建待确认订单，需手动前往"我的订单"确认（推荐）</view>
    <view class="tip-item">• 测试3：自动完成整个流程（创建订单→确认→创建档案）</view>
    <view class="tip-item">• 测试4：查看数据库中所有档案</view>
    <view class="tip-item">• 测试5：删除所有测试产生的数据</view>
    <view class="tip-item">• 测试6：给学号20250002的学生添加4张生活照</view>
    <view class="tip-item">• 测试7：修复所有旧订单，添加测试生活照（解决参考图看不到的问题）</view>
    <view class="tip-item">• 测试8：检查所有订单的审核状态，查看待审核和待确认订单</view>
    <view class="tip-item">• 测试9：批量将所有待审核订单改为待确认状态（修复审核无效问题）</view>
    <view class="tip-item">• 测试10：检查所有订单的生活照字段，统计有无参考图，测试云存储访问</view>
    <view class="tip-item">• 测试11：查看最近5个订单的生活照详细信息，包括URL和字段类型</view>
    <view class="tip-item">• 测试23：迁移订单userId字段，统一订单归属</view>
    <view class="tip-item">• 测试24：诊断订单归属问题，检查当前用户能看到哪些订单</view>
  </view>
</view>

