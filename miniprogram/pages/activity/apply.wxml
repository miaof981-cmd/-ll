<view class="apply-page">
  <!-- é¡¶éƒ¨æ´»åŠ¨ä¿¡æ¯ -->
  <view class="activity-header" wx:if="{{activity}}">
    <image class="activity-cover" src="{{activity.coverImage}}" mode="aspectFill"></image>
    <view class="activity-info">
      <text class="activity-title">{{activity.title}}</text>
      <text class="activity-price">Â¥{{activity.price}}</text>
    </view>
  </view>

  <!-- é€‰æ‹©å­©å­ -->
  <view class="section-card">
    <view class="section-title">ğŸ‘¶ é€‰æ‹©å­©å­</view>
    
    <!-- æ²¡æœ‰å­©å­æ—¶æ˜¾ç¤ºæç¤º -->
    <view wx:if="{{showAddChildTip}}" class="empty-children">
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">æ‚¨è¿˜æ²¡æœ‰æ·»åŠ å­©å­ä¿¡æ¯</text>
      <view class="add-child-btn" bindtap="goToApply">
        <text>ç”³è¯·å…¥å­¦</text>
      </view>
    </view>

    <!-- å­©å­åˆ—è¡¨ -->
    <view wx:else class="children-list">
      <view
        wx:for="{{children}}"
        wx:key="_id"
        class="child-item {{selectedChild && selectedChild._id === item._id ? 'selected' : ''}}"
        bindtap="selectChild"
        data-child="{{item}}"
      >
        <view class="child-avatar">{{item.name.substring(0,1)}}</view>
        <view class="child-info">
          <text class="child-name">{{item.name}}</text>
          <text class="child-detail">å­¦å·: {{item.studentId}}</text>
          <text class="child-detail">{{item.grade}} {{item.class}}</text>
        </view>
        <view wx:if="{{selectedChild && selectedChild._id === item._id}}" class="check-icon">âœ“</view>
      </view>
    </view>
  </view>

  <!-- ç”Ÿæ´»ç…§ -->
  <view wx:if="{{selectedChild}}" class="section-card">
    <view class="section-title">ğŸ“· å‚è€ƒç…§ç‰‡ï¼ˆç”Ÿæ´»ç…§ï¼‰</view>
    <view class="photo-hint">ç”¨äºæ‘„å½±å¸ˆäº†è§£å­©å­ï¼Œæ‹å‡ºæ›´å¥½çš„ç…§ç‰‡</view>
    
    <view class="life-photos">
      <!-- å·²æœ‰ç…§ç‰‡ -->
      <view
        wx:for="{{lifePhotos}}"
        wx:key="index"
        class="photo-item"
      >
        <image class="photo-img" src="{{item}}" mode="aspectFill" bindtap="previewLifePhoto" data-index="{{index}}"></image>
        <view class="delete-photo-btn" bindtap="deleteLifePhoto" data-index="{{index}}">âœ•</view>
      </view>
      
      <!-- æ·»åŠ æŒ‰é’® -->
      <view wx:if="{{lifePhotos.length < 9}}" class="add-photo-btn" bindtap="addLifePhoto">
        <text class="add-icon">+</text>
        <text class="add-text">{{lifePhotos.length === 0 ? 'æ·»åŠ ' : 'è¡¥å……'}}</text>
      </view>
    </view>
  </view>

  <!-- å¤‡æ³¨ -->
  <view wx:if="{{selectedChild}}" class="section-card">
    <view class="section-title">ğŸ’­ æœŸæœ›ä¸è¦æ±‚</view>
    <textarea
      class="remark-input"
      placeholder="è¯·è¾“å…¥æ‚¨çš„æœŸæœ›å’Œè¦æ±‚ï¼ˆé€‰å¡«ï¼‰"
      value="{{remark}}"
      bindinput="onRemarkInput"
      maxlength="200"
    ></textarea>
    <view class="char-count">{{remark.length}}/200</view>
  </view>

  <!-- é€‰æ‹©æ‘„å½±å¸ˆ -->
  <view wx:if="{{selectedChild}}" class="section-card">
    <view class="section-title">ğŸ“¸ é€‰æ‹©æ‘„å½±å¸ˆ</view>
    
    <view wx:if="{{photographers.length === 0}}" class="no-data">
      <text>æš‚æ— æ‘„å½±å¸ˆ</text>
    </view>

    <view wx:else class="photographers-list">
      <view
        wx:for="{{photographers}}"
        wx:key="_id"
        class="photographer-item {{selectedPhotographer && selectedPhotographer._id === item._id ? 'selected' : ''}}"
        bindtap="selectPhotographer"
        data-photographer="{{item}}"
      >
        <image wx:if="{{item.avatar}}" class="photographer-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
        <view wx:else class="photographer-avatar-placeholder">{{item.name.substring(0,1)}}</view>
        
        <view class="photographer-info">
          <text class="photographer-name">{{item.name}}</text>
          <text wx:if="{{item.specialty}}" class="photographer-specialty">{{item.specialty}}</text>
        </view>

        <view wx:if="{{selectedPhotographer && selectedPhotographer._id === item._id}}" class="check-icon">âœ“</view>
      </view>
    </view>
  </view>

  <!-- æäº¤æŒ‰é’® -->
  <view wx:if="{{selectedChild}}" class="submit-bar">
    <view class="total-price">
      <text class="price-label">åˆè®¡ï¼š</text>
      <text class="price-value">Â¥{{activity.price}}</text>
    </view>
    <button class="submit-btn" bindtap="submitOrder">æäº¤è®¢å•</button>
  </view>
</view>
