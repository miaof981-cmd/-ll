<view class="apply-page">
  <!-- 顶部活动信息 -->
  <view class="activity-header" wx:if="{{activity}}">
    <image class="activity-cover" src="{{activity.coverImage}}" mode="aspectFill"></image>
    <view class="activity-info">
      <text class="activity-title">{{activity.title}}</text>
      <text class="activity-price">¥{{activity.price}}</text>
    </view>
  </view>

  <!-- 选择孩子 -->
  <view class="section-card">
    <view class="section-title">👶 选择孩子</view>
    
    <!-- 没有孩子时显示提示 -->
    <view wx:if="{{showAddChildTip}}" class="empty-children">
      <text class="empty-icon">📝</text>
      <text class="empty-text">您还没有添加孩子信息</text>
      <view class="add-child-btn" bindtap="goToApply">
        <text>申请入学</text>
      </view>
    </view>

    <!-- 孩子列表 -->
    <view wx:else class="children-list">
      <view
        wx:for="{{children}}"
        wx:key="_id"
        class="child-item {{selectedChild && selectedChild._id === item._id ? 'selected' : ''}}"
        bindtap="selectChild"
        data-child="{{item}}"
      >
        <view class="child-avatar">{{item.name.substring(0,1)}}</view>
        <view class="child-info">
          <text class="child-name">{{item.name}}</text>
          <text class="child-detail">学号: {{item.studentId}}</text>
          <text class="child-detail">{{item.grade}} {{item.class}}</text>
        </view>
        <view wx:if="{{selectedChild && selectedChild._id === item._id}}" class="check-icon">✓</view>
      </view>
    </view>
  </view>

  <!-- 生活照 -->
  <view wx:if="{{selectedChild}}" class="section-card">
    <view class="section-title">📷 参考照片（生活照）</view>
    <view class="photo-hint">用于摄影师了解孩子，拍出更好的照片</view>
    
    <view class="life-photos">
      <!-- 已有照片 -->
      <view
        wx:for="{{lifePhotos}}"
        wx:key="index"
        class="photo-item"
      >
        <image class="photo-img" src="{{item}}" mode="aspectFill" bindtap="previewLifePhoto" data-index="{{index}}"></image>
        <view class="delete-photo-btn" bindtap="deleteLifePhoto" data-index="{{index}}">✕</view>
      </view>
      
      <!-- 添加按钮 -->
      <view wx:if="{{lifePhotos.length < 9}}" class="add-photo-btn" bindtap="addLifePhoto">
        <text class="add-icon">+</text>
        <text class="add-text">{{lifePhotos.length === 0 ? '添加' : '补充'}}</text>
      </view>
    </view>
  </view>

  <!-- 备注 -->
  <view wx:if="{{selectedChild}}" class="section-card">
    <view class="section-title">💭 期望与要求</view>
    <textarea
      class="remark-input"
      placeholder="请输入您的期望和要求（选填）"
      value="{{remark}}"
      bindinput="onRemarkInput"
      maxlength="200"
    ></textarea>
    <view class="char-count">{{remark.length}}/200</view>
  </view>

  <!-- 选择摄影师 -->
  <view wx:if="{{selectedChild}}" class="section-card">
    <view class="section-title">📸 选择摄影师</view>
    
    <view wx:if="{{photographers.length === 0}}" class="no-data">
      <text>暂无摄影师</text>
    </view>

    <view wx:else class="photographers-list">
      <view
        wx:for="{{photographers}}"
        wx:key="_id"
        class="photographer-item {{selectedPhotographer && selectedPhotographer._id === item._id ? 'selected' : ''}}"
        bindtap="selectPhotographer"
        data-photographer="{{item}}"
      >
        <image wx:if="{{item.avatar}}" class="photographer-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
        <view wx:else class="photographer-avatar-placeholder">{{item.name.substring(0,1)}}</view>
        
        <view class="photographer-info">
          <text class="photographer-name">{{item.name}}</text>
          <text wx:if="{{item.specialty}}" class="photographer-specialty">{{item.specialty}}</text>
        </view>

        <view wx:if="{{selectedPhotographer && selectedPhotographer._id === item._id}}" class="check-icon">✓</view>
      </view>
    </view>
  </view>

  <!-- 提交按钮 -->
  <view wx:if="{{selectedChild}}" class="submit-bar">
    <view class="total-price">
      <text class="price-label">合计：</text>
      <text class="price-value">¥{{activity.price}}</text>
    </view>
    <button class="submit-btn" bindtap="submitOrder">提交订单</button>
  </view>
</view>
