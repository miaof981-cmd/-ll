<!--pages/photographer/order-detail.wxml-->
<view class="container">
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <view wx:else class="content">
    <!-- è®¢å•åŸºæœ¬ä¿¡æ¯ -->
    <view class="order-info-card">
      <view class="card-header">
        <text class="title">è®¢å•ä¿¡æ¯</text>
        <view class="order-status {{order.status}}">
          <text wx:if="{{order.status === 'in_progress'}}">ğŸ“¸ æ‹æ‘„ä¸­</text>
          <text wx:elif="{{order.status === 'pending_confirm'}}">â³ å¾…ç¡®è®¤</text>
          <text wx:elif="{{order.status === 'completed'}}">âœ… å·²å®Œæˆ</text>
          <text wx:else>{{order.status}}</text>
        </view>
      </view>

      <view class="info-row">
        <text class="label">è®¢å•å·ï¼š</text>
        <text class="value">{{order._id}}</text>
      </view>

      <view class="info-row">
        <text class="label">ä¸‹å•æ—¶é—´ï¼š</text>
        <text class="value">{{order.createdAt}}</text>
      </view>

      <view class="info-row" wx:if="{{order.submittedAt}}">
        <text class="label">æäº¤æ—¶é—´ï¼š</text>
        <text class="value">{{order.submittedAt}}</text>
      </view>

      <view class="info-row">
        <text class="label">æ´»åŠ¨åç§°ï¼š</text>
        <text class="value">{{activity.name || 'è¯ä»¶ç…§æ‹æ‘„'}}</text>
      </view>
    </view>

    <!-- å­¦ç”Ÿä¿¡æ¯ -->
    <view class="student-card">
      <view class="card-header">
        <text class="title">å­¦ç”Ÿä¿¡æ¯</text>
      </view>

      <view class="student-details">
        <view class="detail-item">
          <text class="label">å§“åï¼š</text>
          <text class="value">{{order.studentName}}</text>
        </view>

        <view class="detail-item" wx:if="{{student}}">
          <text class="label">æ€§åˆ«ï¼š</text>
          <text class="value">{{student.gender === 'male' ? 'ç”·' : 'å¥³'}}</text>
        </view>

        <view class="detail-item" wx:if="{{student}}">
          <text class="label">å¹´é¾„ï¼š</text>
          <text class="value">{{student.age}}å²</text>
        </view>

        <view class="detail-item" wx:if="{{student}}">
          <text class="label">ç­çº§ï¼š</text>
          <text class="value">{{student.grade}} {{student.class}}</text>
        </view>
      </view>
    </view>

    <!-- å‚è€ƒç…§ç‰‡ï¼ˆç”Ÿæ´»ç…§ï¼‰ -->
    <view class="reference-card" wx:if="{{order.lifePhotos && order.lifePhotos.length > 0}}">
      <view class="card-header">
        <text class="title">ğŸ“· å‚è€ƒç…§ç‰‡ï¼ˆç”Ÿæ´»ç…§ï¼‰</text>
        <text class="subtitle">å…±{{order.lifePhotos.length}}å¼ </text>
      </view>

      <view class="photo-grid">
        <image
          wx:for="{{order.lifePhotos}}"
          wx:key="index"
          class="photo-item"
          src="{{item}}"
          mode="aspectFill"
          bindtap="previewLifePhoto"
          data-index="{{index}}"
        ></image>
      </view>
    </view>

    <!-- å¤‡æ³¨ä¿¡æ¯ -->
    <view class="remark-card" wx:if="{{order.remark}}">
      <view class="card-header">
        <text class="title">ğŸ“ å¤‡æ³¨ä¸è¦æ±‚</text>
      </view>
      <text class="remark-text">{{order.remark}}</text>
    </view>

    <!-- å·²ä¸Šä¼ ä½œå“ -->
    <view class="uploaded-card">
      <view class="card-header">
        <text class="title">ğŸ¨ æˆ‘çš„ä½œå“</text>
        <text class="subtitle">{{uploadedPhotos.length}}/20</text>
      </view>

      <view class="upload-area">
        <!-- å·²ä¸Šä¼ çš„ç…§ç‰‡ -->
        <view class="photo-grid">
          <view
            wx:for="{{uploadedPhotos}}"
            wx:key="index"
            class="upload-item"
          >
            <image
              class="upload-photo"
              src="{{item}}"
              mode="aspectFill"
              bindtap="previewUploadedPhoto"
              data-index="{{index}}"
            ></image>
            <view class="delete-btn" bindtap="deletePhoto" data-index="{{index}}">
              <text>âœ•</text>
            </view>
          </view>

          <!-- ä¸Šä¼ æŒ‰é’® -->
          <view
            wx:if="{{uploadedPhotos.length < 20 && order.status === 'in_progress'}}"
            class="upload-btn"
            bindtap="uploadPhotos"
          >
            <text class="upload-icon">+</text>
            <text class="upload-text">ä¸Šä¼ ç…§ç‰‡</text>
          </view>
        </view>

        <view wx:if="{{uploadedPhotos.length === 0}}" class="empty-upload">
          <text class="empty-icon">ğŸ“¸</text>
          <text class="empty-text">è¿˜æ²¡æœ‰ä¸Šä¼ ä½œå“</text>
          <text class="empty-hint">ç‚¹å‡»ä¸Šæ–¹"+"ä¸Šä¼ ç…§ç‰‡</text>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-bar" wx:if="{{order.status === 'in_progress'}}">
      <button class="action-btn secondary" bindtap="contactUser">
        <text>ğŸ’¬ è”ç³»ç”¨æˆ·</text>
      </button>
      <button 
        class="action-btn primary" 
        bindtap="submitWork"
        disabled="{{uploadedPhotos.length === 0}}"
      >
        <text>âœ… æäº¤ä½œå“</text>
      </button>
    </view>

    <view class="action-bar" wx:elif="{{order.status === 'pending_confirm'}}">
      <view class="status-tip">
        <text class="tip-icon">â³</text>
        <text class="tip-text">ç­‰å¾…ç”¨æˆ·ç¡®è®¤ä¸­...</text>
      </view>
    </view>

    <view class="action-bar" wx:elif="{{order.status === 'completed'}}">
      <view class="status-tip success">
        <text class="tip-icon">âœ…</text>
        <text class="tip-text">è®¢å•å·²å®Œæˆ</text>
      </view>
    </view>
  </view>
</view>

