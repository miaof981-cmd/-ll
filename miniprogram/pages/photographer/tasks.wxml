<!--pages/photographer/tasks.wxml-->
<view class="container">
  <!-- æ‘„å½±å¸ˆä¿¡æ¯å¡ç‰‡ -->
  <view wx:if="{{photographerInfo}}" class="photographer-card">
    <image wx:if="{{photographerInfo.avatar}}" class="avatar" src="{{photographerInfo.avatar}}" mode="aspectFill"></image>
    <view wx:else class="avatar avatar-placeholder">{{photographerInfo.name ? photographerInfo.name.substring(0,1) : 'æ‘„'}}</view>
    <view class="info">
      <text class="name">{{photographerInfo.name}}</text>
      <text class="specialty">{{photographerInfo.specialty || 'ä¸“ä¸šæ‘„å½±å¸ˆ'}}</text>
    </view>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-container">
    <view class="stat-item urgent">
      <text class="stat-value">{{stats.toUpload}}</text>
      <text class="stat-label">å¾…ä¸Šä¼ </text>
    </view>
    <view class="stat-item warning">
      <text class="stat-value">{{stats.rejected}}</text>
      <text class="stat-label">éœ€ä¿®æ”¹</text>
    </view>
    <view class="stat-item review">
      <text class="stat-value">{{stats.pendingReview}}</text>
      <text class="stat-label">å¾…å®¡æ ¸</text>
    </view>
    <view class="stat-item confirm">
      <text class="stat-value">{{stats.pendingConfirm}}</text>
      <text class="stat-label">å¾…ç¡®è®¤</text>
    </view>
    <view class="stat-item success">
      <text class="stat-value">{{stats.completed}}</text>
      <text class="stat-label">å·²å®Œæˆ</text>
    </view>
  </view>

  <!-- çŠ¶æ€ç­›é€‰ -->
  <view class="filter-tabs">
    <view 
      class="filter-tab {{statusFilter === 'all' ? 'active' : ''}}" 
      bindtap="onStatusFilterChange" 
      data-status="all"
    >
      å…¨éƒ¨
    </view>
    <view 
      class="filter-tab {{statusFilter === 'to_upload' ? 'active' : ''}}" 
      bindtap="onStatusFilterChange" 
      data-status="to_upload"
    >
      å¾…ä¸Šä¼ 
    </view>
    <view 
      class="filter-tab {{statusFilter === 'rejected' ? 'active' : ''}}" 
      bindtap="onStatusFilterChange" 
      data-status="rejected"
    >
      éœ€ä¿®æ”¹
    </view>
    <view 
      class="filter-tab {{statusFilter === 'pending_review' ? 'active' : ''}}" 
      bindtap="onStatusFilterChange" 
      data-status="pending_review"
    >
      å¾…å®¡æ ¸
    </view>
    <view 
      class="filter-tab {{statusFilter === 'pending_confirm' ? 'active' : ''}}" 
      bindtap="onStatusFilterChange" 
      data-status="pending_confirm"
    >
      å¾…ç¡®è®¤
    </view>
    <view 
      class="filter-tab {{statusFilter === 'completed' ? 'active' : ''}}" 
      bindtap="onStatusFilterChange" 
      data-status="completed"
    >
      å·²å®Œæˆ
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="orders-container">
    <view wx:if="{{loading}}" class="loading">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <view wx:elif="{{orders.length === 0}}" class="empty">
      <text class="empty-icon">ğŸ“¦</text>
      <text class="empty-text">æš‚æ— è®¢å•</text>
    </view>

    <view wx:else class="orders-list">
      <view 
        wx:for="{{orders}}" 
        wx:key="_id" 
        class="order-card"
        bindtap="viewOrderDetail"
        data-id="{{item._id}}"
      >
        <!-- è®¢å•å¤´éƒ¨ - çŠ¶æ€å’Œç´§æ€¥æ ‡ç­¾ -->
        <view class="order-header">
          <view class="status-badge {{item.displayStatusColor}}">
            {{item.displayStatus}}
          </view>
          <view wx:if="{{item.isUrgent && item.displayStatusColor === 'urgent'}}" class="urgent-badge">
            ğŸ”¥ {{item.daysAgo}}å¤©æœªå¤„ç†
          </view>
        </view>

        <!-- æ´»åŠ¨ä¿¡æ¯ -->
        <view class="activity-section">
          <image 
            wx:if="{{item.activityInfo && item.activityInfo.coverImage}}"
            class="activity-thumb" 
            src="{{item.activityInfo.coverImage}}" 
            mode="aspectFill"
            binderror="onImageError"
            data-id="{{item._id}}"
            data-type="activity"
          />
          <view wx:else class="activity-thumb-placeholder">
            <text>ğŸ“·</text>
          </view>
          <view class="activity-info">
            <text class="activity-name">{{item.activityInfo.name || 'æ´»åŠ¨'}}</text>
            <text class="activity-price">Â¥{{item.activityInfo.price || item.price || 0}}</text>
          </view>
        </view>

        <!-- å­¦ç”Ÿä¿¡æ¯ -->
        <view class="student-info">
          <text class="label">å­¦ç”Ÿï¼š</text>
          <text class="value">{{item.studentName}}</text>
          <text class="order-no">è®¢å•å·ï¼š{{item.orderNo}}</text>
        </view>

        <!-- ç®¡ç†å‘˜é©³å›åŸå›  -->
        <view wx:if="{{item.rejectType === 'admin'}}" class="reject-section admin-reject">
          <view class="reject-header">
            <text class="reject-icon">ğŸš«</text>
            <text class="reject-title">ç®¡ç†å‘˜é©³å›</text>
          </view>
          <view class="reject-meta">
            <text class="reject-time">é©³å›æ—¶é—´ï¼š{{item.adminRejectedAt}}</text>
          </view>
          <text class="reject-reason">{{item.adminRejectReason}}</text>
          <view class="reject-tip">è¯·æ ¹æ®ç®¡ç†å‘˜è¦æ±‚é‡æ–°æ‹æ‘„å¹¶ä¸Šä¼ </view>
        </view>

        <!-- ç”¨æˆ·è¦æ±‚ä¿®æ”¹ -->
        <view wx:elif="{{item.rejectType === 'user'}}" class="reject-section user-reject">
          <view class="reject-header">
            <text class="reject-icon">ğŸ’¬</text>
            <text class="reject-title">ç”¨æˆ·è¦æ±‚ä¿®æ”¹</text>
          </view>
          <view class="reject-meta">
            <text class="reject-time">æ‹’ç»æ—¶é—´ï¼š{{item.rejectedAt}}</text>
            <text class="reject-count">å‰©ä½™ä¿®æ”¹æ¬¡æ•°ï¼š{{3 - (item.rejectCount || 0)}}æ¬¡</text>
          </view>
          <text class="reject-reason">{{item.rejectReason}}</text>
          <view class="reject-tip">è¯·æ ¹æ®ç”¨æˆ·åé¦ˆè¿›è¡Œè°ƒæ•´</view>
        </view>

        <!-- ä½œå“ä¸Šä¼ çŠ¶æ€ -->
        <view class="photo-status">
          <text class="photo-icon">ğŸ“·</text>
          <text class="photo-text">
            {{item.hasPhotos ? 'å·²ä¸Šä¼  ' + item.photoCount + ' å¼ ä½œå“' : 'è¿˜æœªä¸Šä¼ ä½œå“'}}
          </text>
        </view>

        <!-- æ—¶é—´ä¿¡æ¯ -->
        <view class="time-info">
          <text class="time-label">ä¸‹å•æ—¶é—´ï¼š</text>
          <text class="time-value">{{item.timeText}}</text>
        </view>

        <!-- æ“ä½œæç¤º -->
        <view class="action-hint">
          <text wx:if="{{item.displayStatusColor === 'urgent'}}">â†’ ç‚¹å‡»ä¸Šä¼ ä½œå“</text>
          <text wx:elif="{{item.displayStatusColor === 'admin-reject'}}">â†’ ç‚¹å‡»é‡æ–°æ‹æ‘„ä¸Šä¼ </text>
          <text wx:elif="{{item.displayStatusColor === 'user-reject'}}">â†’ ç‚¹å‡»ä¿®æ”¹ä½œå“</text>
          <text wx:elif="{{item.displayStatusColor === 'review'}}">â†’ ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸</text>
          <text wx:elif="{{item.displayStatusColor === 'confirm'}}">â†’ ç­‰å¾…ç”¨æˆ·ç¡®è®¤</text>
          <text wx:else>â†’ ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ·æ–°æŒ‰é’® -->
  <view class="refresh-btn" bindtap="onRefresh">
    <text>ğŸ”„ åˆ·æ–°</text>
  </view>
</view>

