<!--pages/my/my.wxml - ä¸ªäººä¸­å¿ƒ-->
<view class="my-page">
  <!-- å·²ç™»å½•çŠ¶æ€ -->
  <view wx:if="{{isLoggedIn}}">
    <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <view class="user-card">
      <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
      <view class="user-info">
        <text class="nickname">{{userInfo.nickName}}</text>
        <view class="role-badge" bindtap="switchRole" style="background: {{roleConfig[currentRole].color}};">
          <text class="role-icon">{{roleConfig[currentRole].icon}}</text>
          <text class="role-name">{{roleConfig[currentRole].name}}</text>
          <text wx:if="{{userRoles.length > 1}}" class="switch-icon">â‡„</text>
        </view>
        <!-- OpenID æ˜¾ç¤ºåŒºåŸŸï¼ˆç”¨äºæ·»åŠ ç®¡ç†å‘˜ï¼‰ -->
        <view class="openid-box" wx:if="{{userInfo.openid}}" bindtap="copyOpenId">
          <text class="openid-label">OpenID: </text>
          <text class="openid-value">{{userInfo.openid}}</text>
          <text class="copy-icon">ğŸ“‹</text>
        </view>
      </view>
    </view>

    <!-- å®¶é•¿è§†å›¾ï¼šå­©å­åˆ—è¡¨ -->
    <view wx:if="{{currentRole === 'parent'}}" class="children-section">
      <view class="section-header">
        <text class="section-title">æˆ‘çš„å­©å­</text>
        <view class="add-btn" bindtap="addChild">+ æ·»åŠ </view>
      </view>
      
      <view wx:if="{{children.length === 0}}" class="empty-tip">
        <text class="empty-text">è¿˜æ²¡æœ‰å…³è”å­©å­</text>
        <text class="empty-hint">ç‚¹å‡»å³ä¸Šè§’"æ·»åŠ "æŒ‰é’®æ·»åŠ å­©å­</text>
      </view>
      
      <view 
        wx:for="{{children}}" 
        wx:key="studentId"
        class="child-card"
        bindtap="viewChildRecord"
        data-studentid="{{item.studentId}}"
      >
        <view class="child-avatar">{{item.name.substr(0,1)}}</view>
        <view class="child-info">
          <text class="child-name">{{item.name}}</text>
          <text class="child-detail">å­¦å·: {{item.studentId}}</text>
          <text class="child-detail">{{item.grade}} {{item.class}}</text>
        </view>
        <view class="arrow">â†’</view>
      </view>
    </view>

    <!-- ç®¡ç†å‘˜è§†å›¾ï¼šå¿«æ·å…¥å£ -->
    <view wx:if="{{currentRole === 'admin'}}" class="admin-section">
      <text class="section-title">ç®¡ç†åŠŸèƒ½</text>
      <navigator class="menu-item" url="/pages/admin/admin">
        <text class="menu-icon">âš™ï¸</text>
        <text class="menu-text">ç®¡ç†åå°</text>
        <text class="arrow">â†’</text>
      </navigator>
    </view>

    <!-- æ‘„å½±å¸ˆè§†å›¾ï¼šå¿«æ·å…¥å£ -->
    <view wx:if="{{currentRole === 'photographer'}}" class="photographer-section">
      <text class="section-title">æ‘„å½±åŠŸèƒ½</text>
      <navigator class="menu-item" url="/pages/photographer/tasks">
        <text class="menu-icon">ğŸ“·</text>
        <text class="menu-text">æ¥å•ä¸­å¿ƒ</text>
        <text class="arrow">â†’</text>
      </navigator>
    </view>

    <!-- é€šç”¨åŠŸèƒ½ -->
    <view class="menu-section">
      <text class="section-title">åŠŸèƒ½èœå•</text>
      <view class="menu-item" bindtap="myOrders">
        <text class="menu-icon">ğŸ“¦</text>
        <text class="menu-text">æˆ‘çš„è®¢å•</text>
        <text class="arrow">â†’</text>
      </view>
      <view class="menu-item" bindtap="myActivities">
        <text class="menu-icon">ğŸ¯</text>
        <text class="menu-text">æˆ‘çš„æ´»åŠ¨</text>
        <text class="arrow">â†’</text>
      </view>
      <view class="menu-item" bindtap="settings">
        <text class="menu-icon">âš™ï¸</text>
        <text class="menu-text">è®¾ç½®</text>
        <text class="arrow">â†’</text>
      </view>
    </view>

    <!-- é€€å‡ºç™»å½• -->
    <view class="logout-section">
      <button class="logout-btn" bindtap="logout">é€€å‡ºç™»å½•</button>
    </view>
  </view>

  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view wx:else class="not-login">
    <view class="login-icon">ğŸ‘¤</view>
    <text class="login-tip">æ‚¨è¿˜æœªç™»å½•</text>
    <button class="login-btn" bindtap="goToLogin">ç«‹å³ç™»å½•</button>
  </view>
</view>
