<!-- 测试订阅消息页面 -->
<view class="container">
  <!-- 调试日志显示区 -->
  <view class="debug-log">
    <view class="debug-title">📋 调试日志（实时更新）</view>
    <text class="debug-text" wx:if="{{debugLog}}">{{debugLog}}</text>
    <text class="debug-text empty" wx:else>等待测试...</text>
  </view>
  <view class="header">
    <text class="title">📨 订阅消息测试</text>
    <text class="subtitle">测试模板消息功能</text>
  </view>

  <!-- 用户信息 -->
  <view class="info-card">
    <view class="info-item">
      <text class="label">用户OpenID:</text>
      <text class="value">{{userOpenid}}</text>
    </view>
  </view>

  <!-- 测试订单数据 -->
  <view class="info-card">
    <view class="card-title">测试订单数据</view>
    <view class="info-item">
      <text class="label">订单号:</text>
      <text class="value">{{testOrderData.orderNo}}</text>
    </view>
    <view class="info-item">
      <text class="label">学生姓名:</text>
      <text class="value">{{testOrderData.studentName}}</text>
    </view>
    <view class="info-item">
      <text class="label">订单金额:</text>
      <text class="value">¥{{testOrderData.amount}}</text>
    </view>
    <view class="info-item">
      <text class="label">摄影师:</text>
      <text class="value">{{testOrderData.photographerName}}</text>
    </view>
  </view>

  <!-- 测试按钮 -->
  <view class="test-buttons">
    <button class="test-btn" bindtap="testRequestAuth">
      测试1: 请求订阅授权
    </button>
    
    <button class="test-btn primary" bindtap="testSendOrderNotification">
      测试2: 发送订单通知
    </button>
    
    <button class="test-btn success" bindtap="testFullPaymentFlow">
      测试3: 模拟下单并发送通知
    </button>

    <button class="test-btn warning" bindtap="testCloudFunction">
      测试4: 直接测试云函数
    </button>
  </view>

  <!-- 测试结果 -->
  <view class="result-card" wx:if="{{testResult}}">
    <view class="card-title">测试结果</view>
    <text class="result-text">{{testResult}}</text>
    <button class="clear-btn" bindtap="clearResult">清空结果</button>
  </view>

  <!-- 说明 -->
  <view class="tips-card">
    <view class="card-title">💡 测试说明</view>
    <view class="tip-item">
      <text class="tip-number">1</text>
      <text class="tip-text">测试1：只测试授权弹窗，不发送消息</text>
    </view>
    <view class="tip-item">
      <text class="tip-number">2</text>
      <text class="tip-text">测试2：请求授权后立即发送订单通知</text>
    </view>
    <view class="tip-item">
      <text class="tip-number">3</text>
      <text class="tip-text">测试3：模拟下单流程（创建测试订单+发送通知，不涉及支付）</text>
    </view>
  </view>

  <!-- 检查清单 -->
  <view class="checklist-card">
    <view class="card-title">✅ 测试检查清单</view>
    <view class="checklist-item">
      <text class="checkbox">☐</text>
      <text class="checklist-text">云函数 sendSubscribeMessage 已上传</text>
    </view>
    <view class="checklist-item">
      <text class="checkbox">☐</text>
      <text class="checklist-text">模板ID已填入 notification.js</text>
    </view>
    <view class="checklist-item">
      <text class="checkbox">☐</text>
      <text class="checklist-text">已登录小程序（有openid）</text>
    </view>
    <view class="checklist-item">
      <text class="checkbox">☐</text>
      <text class="checklist-text">授权弹窗正常显示</text>
    </view>
    <view class="checklist-item">
      <text class="checkbox">☐</text>
      <text class="checklist-text">微信收到服务通知</text>
    </view>
  </view>
</view>

