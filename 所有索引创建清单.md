# 数据库索引创建完整清单

## 当前状态

✅ `order_photo_history` 集合索引已创建

## 需要创建的其他索引

根据控制台日志，以下索引建议创建以提升性能：

---

### 1. activity_orders 集合 - 索引1

**用途：** 待审核订单列表查询

**索引名称：**
```
status_submittedAt_desc
```

**索引字段：**
| 字段名 | 排序方式 | 说明 |
|--------|----------|------|
| `status` | **升序** | 用于按状态筛选 |
| `submittedAt` | **降序** | 最新提交的在前 |

**对应查询：**
```javascript
db.collection('activity_orders')
  .where({ status: 'pending_review' })
  .orderBy('submittedAt', 'desc')
  .get()
```

---

### 2. activity_orders 集合 - 索引2

**用途：** 摄影师查看自己的订单列表

**索引名称：**
```
photographerId_createdAt_desc
```

**索引字段：**
| 字段名 | 排序方式 | 说明 |
|--------|----------|------|
| `photographerId` | **升序** | 摄影师ID |
| `createdAt` | **降序** | 最新订单在前 |
| `status` | **升序** | 订单状态 |

**对应查询：**
```javascript
db.collection('activity_orders')
  .where({ 
    photographerId: '...',
    status: _.nin(['cancelled', 'refunded'])
  })
  .orderBy('createdAt', 'desc')
  .get()
```

---

### 3. banners 集合

**用途：** 首页轮播图排序

**索引名称：**
```
openid_order_asc
```

**索引字段：**
| 字段名 | 排序方式 | 说明 |
|--------|----------|------|
| `_openid` | **升序** | 管理员ID |
| `order` | **升序** | 显示顺序 |

**对应查询：**
```javascript
db.collection('banners')
  .where({ _openid: '...' })
  .orderBy('order', 'asc')
  .get()
```

**注意：** 创建后可以删除旧的 `_openid_1` 索引（系统会提示）

---

### 4. announcements 集合

**用途：** 公告列表按时间倒序

**索引名称：**
```
openid_createdAt_desc
```

**索引字段：**
| 字段名 | 排序方式 | 说明 |
|--------|----------|------|
| `_openid` | **升序** | 管理员ID |
| `createdAt` | **降序** | 最新公告在前 |

**对应查询：**
```javascript
db.collection('announcements')
  .where({ _openid: '...' })
  .orderBy('createdAt', 'desc')
  .get()
```

**注意：** 创建后可以删除旧的 `_openid_1` 索引（系统会提示）

---

### 5. photographer_accounts 集合

**用途：** 摄影师登录查询

**索引名称：**
```
openid
```

**索引字段：**
| 字段名 | 排序方式 | 说明 |
|--------|----------|------|
| `openid` | **升序** | 用于快速查找摄影师 |

**对应查询：**
```javascript
db.collection('photographer_accounts')
  .where({ openid: '...' })
  .get()
```

---

## 快速创建步骤

### 方法1：使用控制台日志中的快速链接（推荐）

1. 在微信开发者工具控制台中找到索引建议
2. 点击蓝色的 `快速创建索引链接`
3. 会自动打开云数据库并预填索引配置
4. 检查无误后点击确定

### 方法2：手动创建

对于每个集合：
1. 打开云开发 → 数据库
2. 点击对应的集合
3. 点击"索引管理"标签
4. 点击"添加索引"
5. 按照上面的表格填写
6. 点击"确定"

---

## 创建优先级

如果时间有限，按以下优先级创建：

### 高优先级（必须创建）
1. ✅ `order_photo_history` - **已创建**
2. ⚠️ `activity_orders` 索引1 (`status_submittedAt_desc`) - **重要**
3. ⚠️ `activity_orders` 索引2 (`photographerId_createdAt_desc`) - **重要**

### 中优先级（建议创建）
4. ⚠️ `announcements` (`openid_createdAt_desc`)
5. ⚠️ `photographer_accounts` (`openid`)

### 低优先级（性能优化）
6. ⚠️ `banners` (`openid_order_asc`)

---

## 验证索引创建成功

创建完成后，刷新小程序，控制台应该：
- ✅ 不再显示对应的索引建议
- ✅ 查询速度明显提升
- ✅ 日志中不再出现 "索引建议" 提示

---

## 索引管理最佳实践

### 什么时候需要索引？
1. 经常作为查询条件的字段（where）
2. 经常用于排序的字段（orderBy）
3. 组合查询（where + orderBy）需要组合索引

### 索引的缺点
1. 占用存储空间
2. 写入数据时需要更新索引（略慢）
3. 但查询速度提升远大于写入的损失

### 删除多余索引
如果系统提示有"相同前缀的多余索引"，可以考虑删除：
- 例如：创建 `_openid + order` 后，可删除单独的 `_openid` 索引
- 原因：组合索引也可以用于单字段查询

---

## 需要帮助？

如果不确定如何创建，可以：
1. 截图给我看
2. 复制控制台的错误信息
3. 我会指导你一步步完成

现在建议先创建**高优先级的3个索引**（其中1个已完成），其他的可以稍后创建。

