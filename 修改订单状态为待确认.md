# 修改订单状态为待确认（测试水印）

## 通过云开发控制台修改

### 步骤：

1. **打开云开发控制台**
   - 在微信开发者工具中，点击顶部的"云开发"按钮
   - 进入云开发控制台

2. **进入数据库**
   - 点击左侧菜单的"数据库"
   - 选择 `activity_orders` 集合

3. **找到你的订单**
   - 可以通过创建时间排序找到最新的订单
   - 或者通过订单号搜索

4. **修改订单状态**
   点击订单记录的编辑按钮，修改以下字段：
   
   ```json
   {
     "status": "pending_confirm",
     "photos": ["你的照片URL"],
     "submittedAt": "2025-10-14T13:31:47.680Z"
   }
   ```
   
   **重要说明：**
   - `status` 必须是 `"pending_confirm"` （注意引号）
   - `photos` 必须是数组，包含至少一张图片的URL
   - `submittedAt` 是提交时间，可以是任意有效的ISO时间字符串

5. **保存并测试**
   - 点击保存
   - 返回小程序
   - 进入"我的订单"
   - 点击这个订单
   - 点击时间线中的照片预览

## 预期结果

当订单状态为 `pending_confirm` 时：

1. 时间线中会显示"📸 提交作品"部分
2. 照片右上角会有"预览"标记
3. 点击照片时，会显示"添加水印中..."的加载提示
4. 预览时照片上会有红色水印："确认收图后水印自动消除"
5. 水印以45度角倾斜，覆盖整个图片

## 调试方法

如果还是看不到水印，请：

1. **查看控制台日志**
   打开调试器的Console标签，查看以下日志：
   ```
   当前订单状态: pending_confirm
   是否需要水印: true
   开始添加水印...
   Canvas节点未找到 或 水印添加成功: xxx
   ```

2. **检查常见问题**
   - 确认订单状态确实是 `pending_confirm`
   - 确认 `photos` 数组不为空
   - 确认照片URL有效
   - 使用真机预览测试（部分Canvas功能模拟器不支持）

## 快速测试订单数据示例

如果你的订单没有照片，可以先在 `photos` 字段中添加一个测试图片URL：

```json
{
  "status": "pending_confirm",
  "photos": [
    "cloud://cloud1-xxxx.636c-cloud1-xxxx/test.jpg"
  ],
  "submittedAt": "2025-10-14T13:31:47.680Z"
}
```

注意：使用你的云存储中实际存在的图片URL。

## 确认后的变化

点击"✅ 确认满意"按钮后：
- 订单状态变为 `completed`
- 再次预览照片时不会有水印
- 可以正常保存图片

