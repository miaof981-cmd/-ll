<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç´§æ€¥ä¿®å¤ - æ•°æ®ä¸¢å¤±é—®é¢˜</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #dc3545;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .alert {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .section {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 20px;
        }
        button {
            padding: 12px 24px;
            margin: 5px;
            cursor: pointer;
            background: #1f6feb;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
        }
        button:hover { background: #0d47a1; }
        button.danger {
            background: #dc3545;
        }
        button.danger:hover {
            background: #c82333;
        }
        button.success {
            background: #28a745;
        }
        button.success:hover {
            background: #218838;
        }
        .result {
            background: white;
            padding: 15px;
            margin-top: 15px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            max-height: 400px;
            overflow-y: auto;
        }
        .log {
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            margin: 5px 0;
        }
        .log.success { color: #28a745; }
        .log.error { color: #dc3545; }
        .log.info { color: #17a2b8; }
        .log.warning { color: #ffc107; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš¨ ç´§æ€¥ä¿®å¤ï¼šæ•°æ®ä¸¢å¤±é—®é¢˜</h1>
        <p style="color: #666; margin-bottom: 20px;">è¯Šæ–­å¹¶ä¿®å¤localStorageæ•°æ®åˆ·æ–°åä¸¢å¤±çš„é—®é¢˜</p>
        
        <div class="alert">
            <strong>âš ï¸ é‡è¦æç¤ºï¼š</strong> å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯<strong>æ— ç—•/éšç§æ¨¡å¼</strong>ï¼ŒlocalStorageæ•°æ®ä¼šåœ¨å…³é—­æ ‡ç­¾é¡µåä¸¢å¤±ï¼è¯·ä½¿ç”¨<strong>æ™®é€šæ¨¡å¼</strong>ã€‚
        </div>
        
        <!-- è¯Šæ–­1 -->
        <div class="section">
            <h2>ğŸ“‹ æ­¥éª¤1ï¼šæ£€æŸ¥localStorageæ˜¯å¦å¯ç”¨</h2>
            <button onclick="checkLocalStorage()">è¿è¡Œæ£€æŸ¥</button>
            <div class="result" id="result1"></div>
        </div>
        
        <!-- è¯Šæ–­2 -->
        <div class="section">
            <h2>ğŸ’¾ æ­¥éª¤2ï¼šæµ‹è¯•æ•°æ®ä¿å­˜å’Œè¯»å–</h2>
            <button onclick="testSaveAndRead()">æµ‹è¯•ä¿å­˜</button>
            <button onclick="location.reload()">åˆ·æ–°é¡µé¢</button>
            <button onclick="testAfterRefresh()">éªŒè¯åˆ·æ–°å</button>
            <div class="result" id="result2"></div>
        </div>
        
        <!-- è¯Šæ–­3 -->
        <div class="section">
            <h2>ğŸ” æ­¥éª¤3ï¼šæŸ¥çœ‹å½“å‰æ‘„å½±å¸ˆæ•°æ®</h2>
            <button onclick="viewCurrentData()">æŸ¥çœ‹æ•°æ®</button>
            <button class="danger" onclick="clearAllData()">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
            <div class="result" id="result3"></div>
        </div>
        
        <!-- ä¿®å¤æ–¹æ¡ˆ -->
        <div class="section">
            <h2>ğŸ”§ æ­¥éª¤4ï¼šæ‰‹åŠ¨åˆ›å»ºå¹¶ä¿å­˜æ‘„å½±å¸ˆ</h2>
            <button class="success" onclick="manualCreate()">æ‰‹åŠ¨åˆ›å»ºæµ‹è¯•æ‘„å½±å¸ˆ</button>
            <div class="result" id="result4"></div>
        </div>
        
        <!-- æœ€ç»ˆéªŒè¯ -->
        <div class="section">
            <h2>âœ… æ­¥éª¤5ï¼šæœ€ç»ˆéªŒè¯</h2>
            <p style="margin-bottom: 10px;">åˆ›å»ºæ‘„å½±å¸ˆåï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤éªŒè¯ï¼š</p>
            <ol style="margin-left: 20px; line-height: 1.8;">
                <li>ç‚¹å‡»"æ‰‹åŠ¨åˆ›å»ºæµ‹è¯•æ‘„å½±å¸ˆ"</li>
                <li>æŸ¥çœ‹æ˜¯å¦æ˜¾ç¤º"ä¿å­˜æˆåŠŸ"</li>
                <li>ç‚¹å‡»æµè§ˆå™¨çš„åˆ·æ–°æŒ‰é’®ï¼ˆF5ï¼‰</li>
                <li>åˆ·æ–°åç‚¹å‡»"éªŒè¯åˆ·æ–°åçš„æ•°æ®"</li>
                <li>å¦‚æœæ•°æ®è¿˜åœ¨ï¼Œè¯´æ˜ä¿®å¤æˆåŠŸï¼</li>
            </ol>
            <button onclick="finalVerify()">éªŒè¯åˆ·æ–°åçš„æ•°æ®</button>
            <div class="result" id="result5"></div>
        </div>
    </div>
    
    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `[${time}] ${message}`;
            element.appendChild(div);
            element.scrollTop = element.scrollHeight;
        }
        
        function checkLocalStorage() {
            const result = document.getElementById('result1');
            result.innerHTML = '';
            
            log('result1', 'å¼€å§‹æ£€æŸ¥localStorage...', 'info');
            
            try {
                // æµ‹è¯•1ï¼šlocalStorageæ˜¯å¦å­˜åœ¨
                if (typeof localStorage === 'undefined') {
                    log('result1', 'âŒ localStorageä¸å­˜åœ¨ï¼æµè§ˆå™¨ä¸æ”¯æŒlocalStorage', 'error');
                    return;
                }
                log('result1', 'âœ… localStorageå¯¹è±¡å­˜åœ¨', 'success');
                
                // æµ‹è¯•2ï¼šæ˜¯å¦å¯ä»¥å†™å…¥
                const testKey = '__test__' + Date.now();
                localStorage.setItem(testKey, 'test_value');
                log('result1', 'âœ… å¯ä»¥å†™å…¥æ•°æ®', 'success');
                
                // æµ‹è¯•3ï¼šæ˜¯å¦å¯ä»¥è¯»å–
                const testValue = localStorage.getItem(testKey);
                if (testValue === 'test_value') {
                    log('result1', 'âœ… å¯ä»¥è¯»å–æ•°æ®', 'success');
                } else {
                    log('result1', 'âŒ è¯»å–çš„æ•°æ®ä¸æ­£ç¡®', 'error');
                }
                
                // æµ‹è¯•4ï¼šæ˜¯å¦å¯ä»¥åˆ é™¤
                localStorage.removeItem(testKey);
                const afterRemove = localStorage.getItem(testKey);
                if (afterRemove === null) {
                    log('result1', 'âœ… å¯ä»¥åˆ é™¤æ•°æ®', 'success');
                } else {
                    log('result1', 'âŒ åˆ é™¤å¤±è´¥', 'error');
                }
                
                // æµ‹è¯•5ï¼šæ£€æŸ¥å®¹é‡
                let totalSize = 0;
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key)) {
                        totalSize += localStorage[key].length + key.length;
                    }
                }
                log('result1', `âœ… localStorageä½¿ç”¨é‡: ${(totalSize / 1024).toFixed(2)} KB`, 'info');
                
                // æµ‹è¯•6ï¼šæ£€æŸ¥æ˜¯å¦æ˜¯éšç§æ¨¡å¼
                try {
                    localStorage.setItem('__privacy_test__', '1');
                    localStorage.removeItem('__privacy_test__');
                    log('result1', 'âœ… ä¸æ˜¯éšç§æ¨¡å¼ï¼ˆæˆ–éšç§æ¨¡å¼æ”¯æŒlocalStorageï¼‰', 'success');
                } catch (e) {
                    log('result1', 'âŒ å¯èƒ½æ˜¯éšç§æ¨¡å¼ï¼æ•°æ®å¯èƒ½ä¸ä¼šæŒä¹…åŒ–', 'error');
                    log('result1', 'è¯·ä½¿ç”¨æ™®é€šæ¨¡å¼æ‰“å¼€æµè§ˆå™¨', 'warning');
                }
                
                log('result1', '=== æ£€æŸ¥å®Œæˆ ===', 'success');
                
            } catch (e) {
                log('result1', 'âŒ é”™è¯¯: ' + e.message, 'error');
                log('result1', 'å¯èƒ½çš„åŸå› ï¼š', 'warning');
                log('result1', '1. æµè§ˆå™¨ç¦ç”¨äº†localStorage', 'warning');
                log('result1', '2. ä½¿ç”¨äº†éšç§/æ— ç—•æ¨¡å¼', 'warning');
                log('result1', '3. æµè§ˆå™¨è®¾ç½®é˜»æ­¢äº†æ•°æ®å­˜å‚¨', 'warning');
            }
        }
        
        function testSaveAndRead() {
            const result = document.getElementById('result2');
            result.innerHTML = '';
            
            log('result2', 'å¼€å§‹æµ‹è¯•ä¿å­˜å’Œè¯»å–...', 'info');
            
            try {
                const testData = {
                    id: 'TEST_' + Date.now(),
                    name: 'æµ‹è¯•æ‘„å½±å¸ˆ_' + Date.now(),
                    username: 'test_' + Date.now(),
                    password: 'photo123',
                    price: 99,
                    createdAt: new Date().toISOString()
                };
                
                log('result2', 'å‡†å¤‡ä¿å­˜çš„æ•°æ®:', 'info');
                log('result2', JSON.stringify(testData, null, 2), 'info');
                
                // ä¿å­˜
                localStorage.setItem('test_photographers', JSON.stringify([testData]));
                log('result2', 'âœ… æ•°æ®å·²ä¿å­˜åˆ°localStorage', 'success');
                
                // ç«‹å³è¯»å–
                const saved = JSON.parse(localStorage.getItem('test_photographers'));
                if (saved && saved.length > 0 && saved[0].id === testData.id) {
                    log('result2', 'âœ… ç«‹å³è¯»å–æˆåŠŸï¼æ•°æ®æ­£ç¡®', 'success');
                    log('result2', 'è¯»å–åˆ°çš„æ•°æ®:', 'info');
                    log('result2', JSON.stringify(saved[0], null, 2), 'info');
                } else {
                    log('result2', 'âŒ ç«‹å³è¯»å–å¤±è´¥ï¼', 'error');
                }
                
                log('result2', '=== ç°åœ¨è¯·ç‚¹å‡»"åˆ·æ–°é¡µé¢"æŒ‰é’® ===', 'warning');
                log('result2', 'åˆ·æ–°åç‚¹å‡»"éªŒè¯åˆ·æ–°å"æŒ‰é’®', 'warning');
                
            } catch (e) {
                log('result2', 'âŒ é”™è¯¯: ' + e.message, 'error');
            }
        }
        
        function testAfterRefresh() {
            const result = document.getElementById('result2');
            
            log('result2', '=== éªŒè¯åˆ·æ–°åçš„æ•°æ® ===', 'info');
            
            try {
                const saved = localStorage.getItem('test_photographers');
                
                if (!saved) {
                    log('result2', 'âŒ åˆ·æ–°åæ•°æ®ä¸¢å¤±ï¼localStorageä¸­æ²¡æœ‰test_photographers', 'error');
                    log('result2', 'è¿™è¯´æ˜localStorageä¸èƒ½æŒä¹…åŒ–æ•°æ®', 'error');
                    log('result2', 'å¯èƒ½åŸå› ï¼š', 'warning');
                    log('result2', '1. ä½¿ç”¨äº†éšç§/æ— ç—•æ¨¡å¼', 'warning');
                    log('result2', '2. æµè§ˆå™¨è®¾ç½®ä¸å…è®¸æŒä¹…åŒ–å­˜å‚¨', 'warning');
                    return;
                }
                
                const data = JSON.parse(saved);
                if (data && data.length > 0) {
                    log('result2', 'âœ… åˆ·æ–°åæ•°æ®ä»ç„¶å­˜åœ¨ï¼', 'success');
                    log('result2', 'æ•°æ®å†…å®¹:', 'info');
                    log('result2', JSON.stringify(data[0], null, 2), 'info');
                    log('result2', '=== localStorageå·¥ä½œæ­£å¸¸ï¼===', 'success');
                } else {
                    log('result2', 'âŒ æ•°æ®æ ¼å¼ä¸æ­£ç¡®', 'error');
                }
                
            } catch (e) {
                log('result2', 'âŒ é”™è¯¯: ' + e.message, 'error');
            }
        }
        
        function viewCurrentData() {
            const result = document.getElementById('result3');
            result.innerHTML = '';
            
            log('result3', 'æŸ¥çœ‹å½“å‰æ‘„å½±å¸ˆæ•°æ®...', 'info');
            
            try {
                const photographers = localStorage.getItem('photographers');
                
                if (!photographers) {
                    log('result3', 'âš ï¸ æ²¡æœ‰æ‰¾åˆ°photographersæ•°æ®', 'warning');
                    log('result3', 'localStorageä¸­çš„æ‰€æœ‰é”®:', 'info');
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        log('result3', `  ${i + 1}. ${key}`, 'info');
                    }
                    return;
                }
                
                const data = JSON.parse(photographers);
                log('result3', `æ‰¾åˆ° ${data.length} ä¸ªæ‘„å½±å¸ˆ:`, 'success');
                
                data.forEach((p, index) => {
                    log('result3', `æ‘„å½±å¸ˆ${index + 1}: ${p.name} (${p.username}) - Â¥${p.price}`, 'info');
                });
                
                log('result3', 'å®Œæ•´æ•°æ®:', 'info');
                log('result3', JSON.stringify(data, null, 2), 'info');
                
            } catch (e) {
                log('result3', 'âŒ é”™è¯¯: ' + e.message, 'error');
            }
        }
        
        function clearAllData() {
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                return;
            }
            
            const result = document.getElementById('result3');
            log('result3', 'æ¸…ç©ºæ‰€æœ‰æ•°æ®...', 'warning');
            
            localStorage.clear();
            log('result3', 'âœ… æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'success');
        }
        
        function manualCreate() {
            const result = document.getElementById('result4');
            result.innerHTML = '';
            
            log('result4', 'å¼€å§‹æ‰‹åŠ¨åˆ›å»ºæ‘„å½±å¸ˆ...', 'info');
            
            try {
                const photographer = {
                    id: 'PHO' + Date.now(),
                    name: 'æµ‹è¯•æ‘„å½±å¸ˆ',
                    username: 'test123',
                    password: 'photo123',
                    price: 100,
                    specialty: 'æµ‹è¯•é£æ ¼',
                    description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ‘„å½±å¸ˆ',
                    status: 'available',
                    orderCount: 0,
                    createdAt: new Date().toISOString()
                };
                
                log('result4', 'æ‘„å½±å¸ˆæ•°æ®:', 'info');
                log('result4', JSON.stringify(photographer, null, 2), 'info');
                
                // è·å–ç°æœ‰æ•°æ®
                let photographers = [];
                const existing = localStorage.getItem('photographers');
                if (existing) {
                    photographers = JSON.parse(existing);
                    log('result4', `ç°æœ‰æ‘„å½±å¸ˆæ•°é‡: ${photographers.length}`, 'info');
                }
                
                // æ·»åŠ æ–°æ‘„å½±å¸ˆ
                photographers.push(photographer);
                
                // ä¿å­˜
                localStorage.setItem('photographers', JSON.stringify(photographers));
                log('result4', 'âœ… ä¿å­˜æˆåŠŸï¼', 'success');
                
                // éªŒè¯
                const saved = JSON.parse(localStorage.getItem('photographers'));
                const found = saved.find(p => p.id === photographer.id);
                
                if (found) {
                    log('result4', 'âœ… éªŒè¯æˆåŠŸï¼šæ•°æ®å·²ä¿å­˜', 'success');
                    log('result4', `å½“å‰æ‘„å½±å¸ˆæ€»æ•°: ${saved.length}`, 'info');
                    log('result4', '=== ç°åœ¨è¯·åˆ·æ–°é¡µé¢ï¼ˆF5ï¼‰ï¼Œç„¶åç‚¹å‡»"éªŒè¯åˆ·æ–°åçš„æ•°æ®" ===', 'warning');
                } else {
                    log('result4', 'âŒ éªŒè¯å¤±è´¥ï¼šä¿å­˜åæ‰¾ä¸åˆ°æ•°æ®', 'error');
                }
                
            } catch (e) {
                log('result4', 'âŒ é”™è¯¯: ' + e.message, 'error');
            }
        }
        
        function finalVerify() {
            const result = document.getElementById('result5');
            result.innerHTML = '';
            
            log('result5', '=== æœ€ç»ˆéªŒè¯ ===', 'info');
            
            try {
                const photographers = localStorage.getItem('photographers');
                
                if (!photographers) {
                    log('result5', 'âŒ å¤±è´¥ï¼šåˆ·æ–°åæ•°æ®ä¸¢å¤±ï¼', 'error');
                    log('result5', '', 'error');
                    log('result5', 'é—®é¢˜ç¡®è®¤ï¼šlocalStorageä¸èƒ½æŒä¹…åŒ–æ•°æ®', 'error');
                    log('result5', '', 'error');
                    log('result5', 'è§£å†³æ–¹æ¡ˆï¼š', 'warning');
                    log('result5', '1. æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†éšç§/æ— ç—•æ¨¡å¼', 'warning');
                    log('result5', '2. å…³é—­éšç§æ¨¡å¼ï¼Œä½¿ç”¨æ™®é€šæ¨¡å¼', 'warning');
                    log('result5', '3. æ£€æŸ¥æµè§ˆå™¨è®¾ç½®ï¼Œå…è®¸ç½‘ç«™å­˜å‚¨æ•°æ®', 'warning');
                    log('result5', '4. å°è¯•ä½¿ç”¨å…¶ä»–æµè§ˆå™¨ï¼ˆChromeã€Firefoxã€Safariï¼‰', 'warning');
                    return;
                }
                
                const data = JSON.parse(photographers);
                log('result5', 'âœ… æˆåŠŸï¼šåˆ·æ–°åæ•°æ®ä»ç„¶å­˜åœ¨ï¼', 'success');
                log('result5', `æ‘„å½±å¸ˆæ•°é‡: ${data.length}`, 'success');
                
                data.forEach((p, index) => {
                    log('result5', `æ‘„å½±å¸ˆ${index + 1}: ${p.name} (${p.username})`, 'info');
                });
                
                log('result5', '', 'success');
                log('result5', '=== âœ… localStorageå·¥ä½œæ­£å¸¸ï¼===', 'success');
                log('result5', 'ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨æ‘„å½±å¸ˆç®¡ç†åŠŸèƒ½äº†', 'success');
                
            } catch (e) {
                log('result5', 'âŒ é”™è¯¯: ' + e.message, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkLocalStorage();
            }, 500);
        });
    </script>
</body>
</html>

