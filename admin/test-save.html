<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•ä¿å­˜åŠŸèƒ½</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #1f6feb;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background: #0d47a1;
        }
        .result {
            background: white;
            padding: 15px;
            margin-top: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ æ‘„å½±å¸ˆä¿å­˜åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•1ï¼šåˆ›å»ºæµ‹è¯•æ‘„å½±å¸ˆ</h2>
        <button onclick="testCreate()">åˆ›å»ºæµ‹è¯•æ‘„å½±å¸ˆ</button>
        <div class="result" id="result1"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•2ï¼šéªŒè¯æ•°æ®æ˜¯å¦ä¿å­˜</h2>
        <button onclick="testVerify()">éªŒè¯æ•°æ®</button>
        <div class="result" id="result2"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•3ï¼šåˆ·æ–°é¡µé¢åéªŒè¯</h2>
        <button onclick="location.reload()">åˆ·æ–°é¡µé¢</button>
        <button onclick="testAfterRefresh()">éªŒè¯åˆ·æ–°åçš„æ•°æ®</button>
        <div class="result" id="result3"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•4ï¼šæŸ¥çœ‹localStorageåŸå§‹æ•°æ®</h2>
        <button onclick="showRawData()">æŸ¥çœ‹åŸå§‹æ•°æ®</button>
        <div class="result" id="result4"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•5ï¼šæ¸…ç©ºå¹¶é‡å»º</h2>
        <button onclick="clearAndRebuild()">æ¸…ç©ºå¹¶é‡å»º</button>
        <div class="result" id="result5"></div>
    </div>
    
    <script src="js/storage.js"></script>
    <script>
        function log(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = isError ? 'error' : 'success';
            element.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
        }
        
        function testCreate() {
            const result = document.getElementById('result1');
            result.innerHTML = '';
            
            try {
                log('result1', 'å¼€å§‹åˆ›å»ºæµ‹è¯•æ‘„å½±å¸ˆ...');
                
                const testPhotographer = {
                    name: 'TEST_' + Date.now(),
                    username: 'test_' + Date.now(),
                    password: 'photo123',
                    price: 99,
                    specialty: 'æµ‹è¯•ä¸“é•¿',
                    description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ‘„å½±å¸ˆ',
                    status: 'available',
                    orderCount: 0
                };
                
                log('result1', 'æ‘„å½±å¸ˆæ•°æ®: ' + JSON.stringify(testPhotographer, null, 2));
                
                const saved = Storage.savePhotographer(testPhotographer);
                
                if (saved && saved.id) {
                    log('result1', 'âœ… ä¿å­˜æˆåŠŸï¼ID: ' + saved.id);
                    log('result1', 'å®Œæ•´æ•°æ®: ' + JSON.stringify(saved, null, 2));
                    
                    // ç«‹å³éªŒè¯
                    const photographers = Storage.getPhotographers();
                    log('result1', 'å½“å‰æ‘„å½±å¸ˆæ€»æ•°: ' + photographers.length);
                    
                    const found = photographers.find(p => p.id === saved.id);
                    if (found) {
                        log('result1', 'âœ… éªŒè¯æˆåŠŸï¼šæ•°æ®å·²ä¿å­˜åˆ°localStorage');
                    } else {
                        log('result1', 'âŒ éªŒè¯å¤±è´¥ï¼šä¿å­˜åç«‹å³æŸ¥è¯¢æ‰¾ä¸åˆ°æ•°æ®', true);
                    }
                } else {
                    log('result1', 'âŒ ä¿å­˜å¤±è´¥ï¼šè¿”å›å€¼ä¸ºç©º', true);
                }
            } catch (e) {
                log('result1', 'âŒ é”™è¯¯: ' + e.message, true);
                console.error(e);
            }
        }
        
        function testVerify() {
            const result = document.getElementById('result2');
            result.innerHTML = '';
            
            try {
                log('result2', 'å¼€å§‹éªŒè¯æ•°æ®...');
                
                const photographers = Storage.getPhotographers();
                log('result2', 'æ‘„å½±å¸ˆæ€»æ•°: ' + photographers.length);
                
                if (photographers.length > 0) {
                    log('result2', 'âœ… æ‰¾åˆ° ' + photographers.length + ' ä¸ªæ‘„å½±å¸ˆ');
                    photographers.forEach((p, index) => {
                        log('result2', `æ‘„å½±å¸ˆ${index + 1}: ${p.name} (${p.username}) - Â¥${p.price}`);
                    });
                } else {
                    log('result2', 'âŒ æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æ‘„å½±å¸ˆæ•°æ®', true);
                }
                
                // æ£€æŸ¥localStorage
                const rawData = localStorage.getItem('photographers');
                if (rawData) {
                    log('result2', 'âœ… localStorageä¸­æœ‰æ•°æ®ï¼Œé•¿åº¦: ' + rawData.length);
                } else {
                    log('result2', 'âŒ localStorageä¸­æ²¡æœ‰photographersæ•°æ®', true);
                }
            } catch (e) {
                log('result2', 'âŒ é”™è¯¯: ' + e.message, true);
                console.error(e);
            }
        }
        
        function testAfterRefresh() {
            const result = document.getElementById('result3');
            result.innerHTML = '';
            
            try {
                log('result3', 'éªŒè¯åˆ·æ–°åçš„æ•°æ®...');
                
                const photographers = Storage.getPhotographers();
                log('result3', 'æ‘„å½±å¸ˆæ€»æ•°: ' + photographers.length);
                
                if (photographers.length > 0) {
                    log('result3', 'âœ… åˆ·æ–°åæ•°æ®ä»ç„¶å­˜åœ¨');
                    photographers.forEach((p, index) => {
                        log('result3', `æ‘„å½±å¸ˆ${index + 1}: ${p.name} (${p.username})`);
                    });
                } else {
                    log('result3', 'âŒ åˆ·æ–°åæ•°æ®ä¸¢å¤±ï¼', true);
                    log('result3', 'è¿™è¯´æ˜æ•°æ®æ²¡æœ‰çœŸæ­£ä¿å­˜åˆ°localStorage', true);
                }
            } catch (e) {
                log('result3', 'âŒ é”™è¯¯: ' + e.message, true);
                console.error(e);
            }
        }
        
        function showRawData() {
            const result = document.getElementById('result4');
            result.innerHTML = '';
            
            try {
                log('result4', 'æŸ¥çœ‹localStorageåŸå§‹æ•°æ®...');
                
                const rawData = localStorage.getItem('photographers');
                if (rawData) {
                    log('result4', 'âœ… æ‰¾åˆ°æ•°æ®');
                    log('result4', 'æ•°æ®é•¿åº¦: ' + rawData.length + ' å­—ç¬¦');
                    log('result4', 'åŸå§‹JSON:\n' + rawData);
                    
                    try {
                        const parsed = JSON.parse(rawData);
                        log('result4', 'âœ… JSONè§£ææˆåŠŸ');
                        log('result4', 'æ•°ç»„é•¿åº¦: ' + parsed.length);
                    } catch (e) {
                        log('result4', 'âŒ JSONè§£æå¤±è´¥: ' + e.message, true);
                    }
                } else {
                    log('result4', 'âŒ localStorageä¸­æ²¡æœ‰photographersé”®', true);
                    
                    // åˆ—å‡ºæ‰€æœ‰localStorageé”®
                    log('result4', 'localStorageä¸­çš„æ‰€æœ‰é”®:');
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        log('result4', `  ${i + 1}. ${key}`);
                    }
                }
            } catch (e) {
                log('result4', 'âŒ é”™è¯¯: ' + e.message, true);
                console.error(e);
            }
        }
        
        function clearAndRebuild() {
            const result = document.getElementById('result5');
            result.innerHTML = '';
            
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ‘„å½±å¸ˆæ•°æ®å¹¶é‡å»ºå—ï¼Ÿ')) {
                return;
            }
            
            try {
                log('result5', 'æ¸…ç©ºç°æœ‰æ•°æ®...');
                localStorage.removeItem('photographers');
                log('result5', 'âœ… å·²æ¸…ç©º');
                
                log('result5', 'åˆ›å»ºæ–°æ‘„å½±å¸ˆ...');
                const newPhotographer = {
                    name: 'æµ‹è¯•æ‘„å½±å¸ˆ',
                    username: 'test123',
                    password: 'photo123',
                    price: 100,
                    specialty: 'æµ‹è¯•é£æ ¼',
                    description: 'æµ‹è¯•æè¿°',
                    status: 'available',
                    orderCount: 0
                };
                
                const saved = Storage.savePhotographer(newPhotographer);
                
                if (saved && saved.id) {
                    log('result5', 'âœ… åˆ›å»ºæˆåŠŸï¼ID: ' + saved.id);
                    
                    // éªŒè¯
                    const photographers = Storage.getPhotographers();
                    log('result5', 'éªŒè¯ï¼šå½“å‰æ‘„å½±å¸ˆæ•°é‡ = ' + photographers.length);
                    
                    if (photographers.length === 1) {
                        log('result5', 'âœ… éªŒè¯æˆåŠŸï¼');
                        log('result5', 'è¯·åˆ·æ–°é¡µé¢éªŒè¯æ•°æ®æ˜¯å¦æŒä¹…åŒ–');
                    } else {
                        log('result5', 'âŒ éªŒè¯å¤±è´¥ï¼šæ•°é‡ä¸å¯¹', true);
                    }
                } else {
                    log('result5', 'âŒ åˆ›å»ºå¤±è´¥', true);
                }
            } catch (e) {
                log('result5', 'âŒ é”™è¯¯: ' + e.message, true);
                console.error(e);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', () => {
            console.log('æµ‹è¯•é¡µé¢å·²åŠ è½½');
            testVerify();
        });
    </script>
</body>
</html>

