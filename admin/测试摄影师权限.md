# 摄影师权限系统测试指南

## 🎯 测试目标
验证摄影师和管理员的权限完全分离，摄影师只能访问自己的任务，无法访问管理后台。

---

## 📋 测试前准备

### 1. 确保有测试账号

打开浏览器控制台，运行以下代码添加测试摄影师：

```javascript
// 1. 先添加摄影师数据
const photographers = [
  {
    id: 'PHO001',
    name: '星空画师',
    avatar: '',
    specialty: '星空风格',
    description: '擅长星空、梦幻风格的证件照拍摄',
    samples: [],
    status: 'available',
    orderCount: 0,
    createdAt: new Date().toISOString()
  }
];
localStorage.setItem('photographers', JSON.stringify(photographers));

// 2. 添加测试订单（分配给这个摄影师）
const applications = [
  {
    id: 'APP' + Date.now(),
    childName: '测试学生',
    childGender: '男',
    childAge: 8,
    parentName: '测试家长',
    phone: '13800138000',
    wechat: 'test_wechat',
    expectations: '希望孩子能够快乐成长，学业进步。',
    lifePhoto: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="200" height="200"%3E%3Crect fill="%233b82f6" width="200" height="200"/%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" fill="white" font-size="60"%3E照%3C/text%3E%3C/svg%3E',
    photographerId: 'PHO001',
    photographerName: '星空画师',
    status: 'waiting_draw',
    createdAt: new Date().toISOString()
  }
];
localStorage.setItem('applications', JSON.stringify(applications));

console.log('✅ 测试数据已添加');
```

### 2. 登录账号信息

**管理员账号：**
- 用户名：`admin`
- 密码：`admin123`
- 角色：管理员

**摄影师账号：**（需要在 `admin/js/auth.js` 中添加）

打开 `admin/js/auth.js`，找到 `defaultUsers` 数组，添加：

```javascript
{
  username: 'photographer1',
  password: 'photo123',
  name: '星空画师',
  role: 'photographer',
  photographerId: 'PHO001'
}
```

---

## ✅ 测试用例

### 测试1：摄影师登录跳转
**目的**：验证摄影师登录后跳转到专用工作台

**步骤**：
1. 打开 `admin/index.html`
2. 选择"摄影师"角色
3. 输入用户名：`photographer1`
4. 输入密码：`photo123`
5. 点击"登录"

**预期结果**：
- ✅ 登录成功
- ✅ 自动跳转到 `photographer-dashboard.html`
- ✅ 看到紫色渐变的专用工作台
- ✅ 顶部显示"星空画师"
- ✅ 看到统计数据（等待绘制、审核中、已完成）
- ✅ 看到任务列表

---

### 测试2：摄影师只能看到自己的订单
**目的**：验证数据隔离

**步骤**：
1. 摄影师登录后
2. 查看任务列表

**预期结果**：
- ✅ 只显示 `photographerId` 为 `PHO001` 的订单
- ✅ 看不到其他摄影师的订单
- ✅ 任务卡片显示完整信息（孩子姓名、生活照、家长期许）

---

### 测试3：摄影师无法访问管理页面
**目的**：验证权限控制

**步骤**：
1. 摄影师登录后
2. 手动在地址栏输入：`dashboard.html`
3. 按回车

**预期结果**：
- ✅ 被拦截
- ✅ 自动跳转回 `photographer-dashboard.html`

**继续测试**：
4. 尝试访问 `pages/students.html`

**预期结果**：
- ✅ 弹出提示："您没有权限访问此页面"
- ✅ 自动跳转回 `photographer-dashboard.html`

**其他管理页面也测试**：
- `pages/applications.html`
- `pages/photographers.html`
- `pages/announcements.html`
- `pages/banners.html`

全部应该被拦截！

---

### 测试4：上传作品功能
**目的**：验证摄影师核心功能

**步骤**：
1. 摄影师登录
2. 在任务列表找到"等待绘制"的订单
3. 点击"📤 上传作品"按钮
4. 在弹窗中选择图片文件
5. 填写备注："星空风格，已调整色调"
6. 点击"提交审核"

**预期结果**：
- ✅ 弹窗打开正常
- ✅ 图片上传成功并显示预览
- ✅ 点击"提交审核"后弹出确认框
- ✅ 确认后订单状态变为"审核中"
- ✅ 按钮变为"⏳ 等待客服审核中..."（禁用状态）
- ✅ 统计数据更新（等待绘制-1，审核中+1）

---

### 测试5：管理员登录正常
**目的**：验证管理员不受影响

**步骤**：
1. 退出摄影师账号
2. 选择"管理员"角色
3. 输入用户名：`admin`
4. 输入密码：`admin123`
5. 点击"登录"

**预期结果**：
- ✅ 登录成功
- ✅ 跳转到 `dashboard.html`（管理后台）
- ✅ 看到蓝色主题的管理界面
- ✅ 侧边栏显示所有管理功能
- ✅ 可以正常访问所有管理页面

---

### 测试6：管理员无法访问摄影师工作台
**目的**：验证反向权限控制

**步骤**：
1. 管理员登录后
2. 手动访问 `photographer-dashboard.html`

**预期结果**：
- ✅ 被拦截
- ✅ 自动跳转回 `dashboard.html`

---

### 测试7：状态筛选功能
**目的**：验证摄影师可以筛选任务

**步骤**：
1. 摄影师登录
2. 点击右上角的状态筛选下拉框
3. 选择"等待绘制"

**预期结果**：
- ✅ 只显示状态为"等待绘制"的订单
- ✅ 其他状态的订单被隐藏

**继续测试**：
4. 选择"审核中"

**预期结果**：
- ✅ 只显示状态为"审核中"的订单

---

### 测试8：图片预览功能
**目的**：验证摄影师可以查看大图

**步骤**：
1. 摄影师登录
2. 点击任务卡片中的生活照

**预期结果**：
- ✅ 弹出全屏预览
- ✅ 图片居中显示
- ✅ 点击任意位置关闭

---

## 🐛 常见问题排查

### 问题1：摄影师登录后看不到任务
**原因**：订单的 `photographerId` 与摄影师账号的 `photographerId` 不匹配

**解决**：
1. 检查订单数据中的 `photographerId`
2. 检查 `auth.js` 中摄影师账号的 `photographerId`
3. 确保两者一致

### 问题2：摄影师能访问管理页面
**原因**：权限检查代码未生效

**解决**：
1. 检查浏览器控制台是否有错误
2. 确认 `auth.js` 已正确加载
3. 清除浏览器缓存后重试

### 问题3：上传作品后状态没变
**原因**：点击了"保存"而不是"提交审核"

**说明**：
- "保存"只保存作品，不改变状态
- "提交审核"才会将状态改为"审核中"

---

## 📊 测试检查清单

复制以下清单，逐项测试并打勾：

```
□ 摄影师登录跳转到专用工作台
□ 摄影师只能看到自己的订单
□ 摄影师无法访问 dashboard.html
□ 摄影师无法访问 students.html
□ 摄影师无法访问 applications.html
□ 摄影师无法访问 photographers.html
□ 摄影师无法访问 announcements.html
□ 摄影师无法访问 banners.html
□ 摄影师可以上传作品
□ 摄影师可以提交审核
□ 摄影师可以筛选任务状态
□ 摄影师可以预览图片
□ 管理员登录跳转到管理后台
□ 管理员可以访问所有管理页面
□ 管理员无法访问摄影师工作台
```

---

## 🎉 测试通过标准

**全部测试用例通过**，即：
- ✅ 摄影师和管理员登录后跳转到不同页面
- ✅ 摄影师只能看到自己的订单
- ✅ 摄影师无法访问任何管理页面
- ✅ 摄影师可以正常上传作品和提交审核
- ✅ 管理员可以访问所有管理功能
- ✅ 管理员无法访问摄影师工作台

---

## 📸 测试截图建议

建议截图保存以下界面：
1. 摄影师登录后的工作台首页
2. 摄影师任务列表
3. 摄影师上传作品弹窗
4. 摄影师尝试访问管理页面被拦截
5. 管理员登录后的管理后台

---

**测试完成时间**：_______  
**测试人员**：_______  
**测试结果**：□ 通过  □ 不通过  
**备注**：_______________________

