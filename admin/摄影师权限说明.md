# 摄影师权限系统说明

## 权限设计原则

### 角色分离
系统现在有三种角色，各自有独立的访问权限：

1. **管理员 (admin)**
   - 可以访问所有管理后台功能
   - 可以管理学生、公告、轮播图、摄影师、订单
   - 登录后跳转到：`dashboard.html`

2. **客服 (service)**
   - 可以查看和管理订单
   - 可以审核摄影师作品
   - 可以上传录取通知书
   - 登录后跳转到：`dashboard.html`

3. **摄影师 (photographer)**
   - **只能访问自己的专用工作台**
   - **只能看到分配给自己的订单**
   - 可以上传作品和提交审核
   - **不能访问任何管理后台页面**
   - 登录后跳转到：`photographer-dashboard.html`

---

## 摄影师专用工作台

### 访问地址
`admin/photographer-dashboard.html`

### 功能特点

1. **独立的界面设计**
   - 紫色渐变主题（区别于管理后台的蓝色）
   - 简洁的任务卡片展示
   - 无侧边栏导航（不需要访问其他页面）

2. **任务统计**
   - 等待绘制：需要上传作品的订单数
   - 审核中：已提交等待客服审核的订单数
   - 已完成：客户已确认的订单数

3. **任务列表**
   - 只显示分配给当前摄影师的订单
   - 显示孩子信息、生活照、家长期许
   - 可以上传作品文件
   - 可以填写备注说明
   - 可以提交审核

4. **状态筛选**
   - 全部任务
   - 等待绘制
   - 审核中
   - 待客户确认
   - 已完成

---

## 权限控制实现

### 1. 登录跳转
```javascript
// admin/js/login.js
if (result.user.role === 'photographer') {
  window.location.href = 'photographer-dashboard.html';
} else {
  window.location.href = 'dashboard.html';
}
```

### 2. 页面访问控制
所有管理后台页面都添加了权限检查：

```javascript
// 检查权限：摄影师不能访问
const currentUser = Auth.getCurrentUser();
if (currentUser.role === 'photographer') {
  alert('您没有权限访问此页面');
  window.location.href = 'photographer-dashboard.html';
  return;
}
```

### 3. 数据过滤
摄影师只能看到自己的订单：

```javascript
// 只显示分配给当前摄影师的任务
const myTasks = applications.filter(app => 
  app.photographerId === currentPhotographerId
);
```

---

## 测试步骤

### 测试1：摄影师登录
1. 打开 `admin/index.html`
2. 选择"摄影师"角色
3. 输入摄影师账号（需要先在管理后台创建）
4. 点击登录
5. ✅ 应该跳转到 `photographer-dashboard.html`
6. ✅ 应该看到紫色渐变的专用工作台

### 测试2：摄影师权限限制
1. 摄影师登录后
2. 尝试手动访问 `dashboard.html`
3. ✅ 应该被拦截并重定向到 `photographer-dashboard.html`
4. 尝试访问 `pages/students.html`
5. ✅ 应该提示"您没有权限访问此页面"

### 测试3：只看自己的订单
1. 管理员创建多个订单，分配给不同摄影师
2. 摄影师A登录
3. ✅ 只能看到分配给摄影师A的订单
4. ✅ 看不到分配给其他摄影师的订单

### 测试4：上传作品流程
1. 摄影师登录工作台
2. 在任务列表中找到"等待绘制"的订单
3. 点击"上传作品"
4. 选择图片文件
5. 填写备注说明
6. 点击"提交审核"
7. ✅ 订单状态变为"审核中"
8. ✅ 按钮变为"等待客服审核中..."

### 测试5：管理员登录
1. 打开 `admin/index.html`
2. 选择"管理员"角色
3. 输入：admin / admin123
4. 点击登录
5. ✅ 应该跳转到 `dashboard.html`
6. ✅ 可以访问所有管理功能

---

## 创建摄影师账号

### 方法1：通过管理后台创建
1. 管理员登录
2. 进入"摄影师管理"
3. 点击"添加摄影师"
4. 填写信息（姓名、专长、作品等）
5. 保存后，摄影师ID会自动生成

### 方法2：在代码中添加测试账号
修改 `admin/js/auth.js`，在 `defaultUsers` 中添加：

```javascript
{
  username: 'photographer1',
  password: 'photo123',
  name: '星空画师',
  role: 'photographer',
  photographerId: 'PHO1' // 需要对应摄影师管理中的ID
}
```

---

## 权限对比表

| 功能 | 管理员 | 客服 | 摄影师 |
|------|--------|------|--------|
| 数据概览 | ✅ | ✅ | ❌ |
| 学生管理 | ✅ | ✅ | ❌ |
| 订单管理 | ✅ | ✅ | ❌ |
| 摄影师管理 | ✅ | ❌ | ❌ |
| 公告管理 | ✅ | ✅ | ❌ |
| 轮播图管理 | ✅ | ❌ | ❌ |
| 查看自己的任务 | ❌ | ❌ | ✅ |
| 上传作品 | ❌ | ❌ | ✅ |
| 提交审核 | ❌ | ❌ | ✅ |

---

## 安全注意事项

1. **前端权限检查**
   - 每个页面都有权限验证
   - 摄影师无法通过URL直接访问管理页面

2. **数据隔离**
   - 摄影师只能看到自己的订单
   - 无法访问其他摄影师的数据

3. **操作限制**
   - 摄影师只能上传作品和提交审核
   - 无法修改订单状态（除了提交审核）
   - 无法删除或修改其他数据

4. **后端验证（重要）**
   - 当前是本地存储，前端验证即可
   - 如果迁移到云端，必须在后端也做权限验证
   - 云函数中需要验证用户身份和权限

---

## 常见问题

### Q: 摄影师如何获取登录账号？
A: 管理员在"摄影师管理"中创建摄影师时，系统会生成摄影师ID。管理员需要在auth.js中手动添加对应的登录账号，或者实现注册功能。

### Q: 摄影师能看到其他摄影师的订单吗？
A: 不能。系统会根据 `photographerId` 过滤订单，确保每个摄影师只能看到分配给自己的订单。

### Q: 摄影师能修改订单信息吗？
A: 不能。摄影师只能上传作品文件和填写备注，无法修改订单的其他信息。

### Q: 如果摄影师尝试访问管理页面会怎样？
A: 系统会拦截并提示"您没有权限访问此页面"，然后自动跳转回摄影师工作台。

---

## 下一步优化建议

1. **自动账号生成**
   - 创建摄影师时自动生成登录账号
   - 发送账号信息到摄影师邮箱/手机

2. **密码修改功能**
   - 摄影师可以修改自己的密码
   - 忘记密码找回功能

3. **消息通知**
   - 新订单分配时通知摄影师
   - 审核结果通知摄影师

4. **作品历史**
   - 摄影师可以查看自己的历史作品
   - 统计完成订单数和好评率

5. **移动端适配**
   - 优化移动端显示
   - 支持手机上传作品

---

**更新时间**: 2025-10-13  
**版本**: v2.0 - 权限分离版本

