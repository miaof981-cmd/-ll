# 快速添加摄影师权限

## 最快的解决方案（3分钟搞定）

### 步骤1: 获取你的OpenID (30秒)

1. 在小程序中打开"我的"页面
2. 你会看到 `OpenID: oxxx...` 
3. **点击这一行**，会自动复制到剪贴板
4. 粘贴到备忘录保存

### 步骤2: 在云数据库添加权限 (2分钟)

#### 方法A: 使用微信开发者工具（推荐）

1. 打开微信开发者工具
2. 点击顶部 "云开发" 按钮
3. 左侧点击 "数据库"
4. 找到 `photographer_accounts` 集合（如果没有就创建）
5. 点击 "添加记录"
6. 填写以下内容：

```json
{
  "openid": "粘贴你刚才复制的OpenID",
  "photographerId": "可以随便填一个，比如 photographer_001",
  "name": "你的名字",
  "isActive": true,
  "createdAt": "2025-01-14T12:00:00.000Z"
}
```

7. 点击"确定"保存

#### 方法B: 使用云开发网页控制台

1. 浏览器打开：https://console.cloud.tencent.com/tcb
2. 选择你的环境
3. 左侧菜单 → 数据库
4. 找到 `photographer_accounts` 集合
5. 点击"添加记录"
6. 填写上面的内容
7. 保存

### 步骤3: 清除缓存重新登录 (30秒)

1. 在小程序"我的"页面点击"退出登录"
2. 开发者工具中点击"清除缓存" → "清除全部缓存"
3. 点击"编译"
4. 重新登录

### 步骤4: 验证是否成功 (10秒)

登录后在"我的"页面应该看到：

✅ **成功标志：**
- 看到 📷 摄影师 徽章
- 出现"摄影功能"区域
- 有"📷 工作台"菜单项

❌ **如果还是没有：**
请按下面的"终极方案"操作

---

## 终极方案（100%有效）

### 如果上面的方法还是不行，使用云函数强制添加

1. 打开微信开发者工具
2. 找到 `cloudfunctions` 文件夹
3. 创建一个新的云函数（或使用已有的）
4. 运行以下代码：

```javascript
// 在云函数中运行
const cloud = require('wx-server-sdk')
cloud.init({ env: cloud.DYNAMIC_CURRENT_ENV })
const db = cloud.database()

exports.main = async (event, context) => {
  const openid = "你的OpenID"  // 替换成你的OpenID
  
  // 1. 检查是否已存在
  const check = await db.collection('photographer_accounts')
    .where({ openid: openid })
    .get()
  
  if (check.data.length > 0) {
    return { success: true, message: '已存在摄影师权限' }
  }
  
  // 2. 添加摄影师权限
  await db.collection('photographer_accounts').add({
    data: {
      openid: openid,
      photographerId: 'temp_' + Date.now(),
      name: '摄影师',
      isActive: true,
      createdAt: new Date().toISOString()
    }
  })
  
  return { success: true, message: '摄影师权限添加成功' }
}
```

5. 上传并部署这个云函数
6. 在云函数列表中点击"测试"
7. 查看返回结果

---

## 常见错误和修复

### 错误1: "集合不存在"

**原因：** `photographer_accounts` 集合还没创建

**解决：**
1. 云开发 → 数据库
2. 点击"添加集合"
3. 集合名称输入：`photographer_accounts`
4. 确定
5. 然后再添加记录

### 错误2: "没有权限"

**原因：** 云数据库权限设置问题

**解决：**
1. 找到 `photographer_accounts` 集合
2. 点击"权限设置"
3. 设置为：**所有用户可读，仅创建者可读写**
4. 保存

### 错误3: 添加了记录但还是没权限

**原因：** 云函数缓存

**解决：**
1. 右键 `cloudfunctions/unifiedLogin` 文件夹
2. 选择"云函数增量上传: 更新文件"
3. 等待上传完成（看到"上传成功"提示）
4. 重新登录

---

## 检查清单

在联系技术支持前，请确认：

- [ ] 已正确复制OpenID（以 o 开头的一长串字符）
- [ ] `photographer_accounts` 集合已创建
- [ ] 已在集合中添加记录
- [ ] `isActive` 字段确实是 `true`（布尔类型）
- [ ] 已重新部署 `unifiedLogin` 云函数
- [ ] 已清除缓存并重新登录
- [ ] Console 中查看了登录日志

---

## 快速测试命令

在开发者工具 Console 中运行：

```javascript
// 查看本地存储的用户信息
console.log('用户信息:', wx.getStorageSync('unifiedUserInfo'))
console.log('用户角色:', wx.getStorageSync('userRoles'))
console.log('当前角色:', wx.getStorageSync('currentRole'))
```

**应该看到：**
```
用户角色: ["parent", "photographer"]  ← 包含 photographer
```

如果没有，说明登录时没有正确识别摄影师权限。

