# 推荐创建的数据库索引

根据控制台日志分析，以下索引能显著提升查询性能：

## 1. activity_orders 集合

### 索引1：订单查询
```json
[
  { "field": "_openid", "type": 1 },
  { "field": "createdAt", "type": -1 }
]
```
**用途：** 用户查询自己的订单列表

---

## 2. order_photo_history 集合

### 索引1：历史记录查询
```json
[
  { "field": "orderId", "type": 1 },
  { "field": "rejectType", "type": 1 },
  { "field": "createdAt", "type": -1 }
]
```
**用途：** 查询订单的历史提交记录（区分管理员/用户拒绝）

---

## 3. students 集合

### 索引1：学号查询
```json
[
  { "field": "studentId", "type": 1 }
]
```
**用途：** 通过学号快速查找学生

---

## 4. banners 集合

### 索引1：轮播图排序
```json
[
  { "field": "_openid", "type": 1 },
  { "field": "order", "type": 1 }
]
```
**用途：** 按顺序获取轮播图

---

## 5. announcements 集合

### 索引1：公告列表
```json
[
  { "field": "_openid", "type": 1 },
  { "field": "createdAt", "type": -1 }
]
```
**用途：** 按时间倒序获取公告

---

## 6. activity_categories 集合

### 索引1：分类排序
```json
[
  { "field": "sort", "type": 1 }
]
```
**用途：** 按顺序获取活动分类

---

## 创建方法

### 方式1：点击快速链接（推荐）
控制台中显示的 `cloud://createindex?env=...` 链接可以直接点击创建

### 方式2：手动创建
1. 进入云开发控制台
2. 点击"数据库"
3. 选择对应的集合
4. 点击"索引管理"
5. 点击"添加索引"
6. 输入字段名和排序方向
7. 点击"确定"

---

## 性能提升

创建索引后：
- ✅ 查询速度提升 10-100 倍
- ✅ 减少数据库扫描
- ✅ 降低云开发费用
- ✅ 提升用户体验

## 注意事项

1. **索引创建需要时间**：数据量大时可能需要几分钟
2. **旧索引清理**：创建新索引后，可以删除被包含的旧索引
   - 例如：创建了 `_openid + createdAt` 组合索引后，可以删除单独的 `_openid` 索引
3. **不要过度索引**：每个集合最多32个索引，只创建常用查询的索引

