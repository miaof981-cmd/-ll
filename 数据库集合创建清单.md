# æ•°æ®åº“é›†åˆåˆ›å»ºæ¸…å•

## âš ï¸ é‡è¦æç¤º

åœ¨ä½¿ç”¨å°ç¨‹åºä¹‹å‰ï¼Œéœ€è¦åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„äº‘å¼€å‘æ§åˆ¶å°åˆ›å»ºä»¥ä¸‹æ•°æ®åº“é›†åˆã€‚

---

## ğŸ“‹ å¿…éœ€çš„æ•°æ®åº“é›†åˆ

è¯·åœ¨ **å¾®ä¿¡å¼€å‘è€…å·¥å…·** â†’ **äº‘å¼€å‘** â†’ **æ•°æ®åº“** ä¸­åˆ›å»ºä»¥ä¸‹é›†åˆï¼š

### 1. ç”¨æˆ·ç›¸å…³

| é›†åˆåç§° | è¯´æ˜ | æƒé™è®¾ç½® |
|---------|------|---------|
| `users` | ç”¨æˆ·ä¿¡æ¯ | æ‰€æœ‰ç”¨æˆ·å¯è¯»ï¼Œä»…åˆ›å»ºè€…å¯å†™ |
| `admin_list` | ç®¡ç†å‘˜ç™½åå• | ä»…ç®¡ç†å‘˜å¯è¯»å†™ |
| `photographer_accounts` | æ‘„å½±å¸ˆè´¦å· | ä»…ç®¡ç†å‘˜å¯è¯»å†™ |

### 2. å­¦ç”Ÿç®¡ç†

| é›†åˆåç§° | è¯´æ˜ | æƒé™è®¾ç½® |
|---------|------|---------|
| `students` | å­¦ç”Ÿä¿¡æ¯ | æ‰€æœ‰ç”¨æˆ·å¯è¯»ï¼Œä»…åˆ›å»ºè€…å’Œç®¡ç†å‘˜å¯å†™ |
| `archives` | å­¦ç±æ¡£æ¡ˆ | æ‰€æœ‰ç”¨æˆ·å¯è¯»ï¼Œä»…ç®¡ç†å‘˜å¯å†™ |

### 3. æ´»åŠ¨ä¸è®¢å•

| é›†åˆåç§° | è¯´æ˜ | æƒé™è®¾ç½® |
|---------|------|---------|
| `activities` | æ´»åŠ¨ä¿¡æ¯ | æ‰€æœ‰ç”¨æˆ·å¯è¯»ï¼Œä»…ç®¡ç†å‘˜å¯å†™ |
| `activity_categories` | æ´»åŠ¨åˆ†ç±» | æ‰€æœ‰ç”¨æˆ·å¯è¯»ï¼Œä»…ç®¡ç†å‘˜å¯å†™ |
| `activity_orders` | æ´»åŠ¨è®¢å• | ä»…åˆ›å»ºè€…å’Œç®¡ç†å‘˜å¯è¯»å†™ |

### 4. æ‘„å½±å¸ˆç®¡ç†

| é›†åˆåç§° | è¯´æ˜ | æƒé™è®¾ç½® |
|---------|------|---------|
| `photographers` | æ‘„å½±å¸ˆä¿¡æ¯ | æ‰€æœ‰ç”¨æˆ·å¯è¯»ï¼Œä»…ç®¡ç†å‘˜å¯å†™ |

### 5. å†…å®¹ç®¡ç†

| é›†åˆåç§° | è¯´æ˜ | æƒé™è®¾ç½® |
|---------|------|---------|
| `announcements` | å…¬å‘Š | æ‰€æœ‰ç”¨æˆ·å¯è¯»ï¼Œä»…ç®¡ç†å‘˜å¯å†™ |
| `banners` | è½®æ’­å›¾ | æ‰€æœ‰ç”¨æˆ·å¯è¯»ï¼Œä»…ç®¡ç†å‘˜å¯å†™ |

---

## ğŸš€ å¿«é€Ÿåˆ›å»ºæ­¥éª¤

### æ–¹æ³•ä¸€ï¼šé€ä¸ªåˆ›å»ºï¼ˆæ¨èï¼‰

1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. ç‚¹å‡»å·¦ä¾§ **"äº‘å¼€å‘"** æŒ‰é’®
3. è¿›å…¥ **"æ•°æ®åº“"** æ ‡ç­¾
4. ç‚¹å‡» **"+"** æˆ– **"æ·»åŠ é›†åˆ"**
5. è¾“å…¥é›†åˆåç§°ï¼ˆå¦‚ï¼š`users`ï¼‰
6. ç‚¹å‡»ç¡®å®š
7. é‡å¤æ­¥éª¤4-6ï¼Œåˆ›å»ºæ‰€æœ‰é›†åˆ

### æ–¹æ³•äºŒï¼šæ‰¹é‡åˆ›å»º

å¦‚æœæ‚¨ç†Ÿæ‚‰æ•°æ®åº“æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨äº‘å¼€å‘æ§åˆ¶å°çš„æ‰¹é‡å¯¼å…¥åŠŸèƒ½ã€‚

---

## âœ… éªŒè¯é›†åˆæ˜¯å¦åˆ›å»ºæˆåŠŸ

åˆ›å»ºå®Œæˆåï¼Œæ‚¨åº”è¯¥åœ¨æ•°æ®åº“åˆ—è¡¨ä¸­çœ‹åˆ°ä»¥ä¸‹12ä¸ªé›†åˆï¼š

- [x] users
- [x] admin_list
- [x] photographer_accounts
- [x] students
- [x] archives
- [x] activities
- [x] activity_categories  âš ï¸ **æ–°å¢ï¼Œå¿…é¡»åˆ›å»º**
- [x] activity_orders
- [x] photographers
- [x] announcements
- [x] banners

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: æç¤º "database collection not exists" é”™è¯¯

**åŸå› ï¼š** å¯¹åº”çš„æ•°æ®åº“é›†åˆæœªåˆ›å»º

**è§£å†³ï¼š** 
1. æ£€æŸ¥ä¸Šé¢çš„æ¸…å•
2. åœ¨äº‘å¼€å‘æ•°æ®åº“ä¸­åˆ›å»ºç¼ºå¤±çš„é›†åˆ
3. åˆ·æ–°å°ç¨‹åº

### Q2: `activity_categories` æ˜¯ä»€ä¹ˆï¼Ÿ

**è¯´æ˜ï¼š** è¿™æ˜¯æ–°å¢çš„æ´»åŠ¨åˆ†ç±»é›†åˆï¼Œç”¨äºç®¡ç†æ´»åŠ¨çš„åˆ†ç±»ï¼ˆå¦‚ï¼šè¯ä»¶ç…§ã€æ¯•ä¸šç…§ã€è‰ºæœ¯ç…§ç­‰ï¼‰

**å¿…é¡»åˆ›å»ºï¼š** æ˜¯çš„ï¼Œå¦åˆ™æ´»åŠ¨é¡µé¢ä¼šæŠ¥é”™

### Q3: æ•°æ®åº“æƒé™å¦‚ä½•è®¾ç½®ï¼Ÿ

**å»ºè®®è®¾ç½®ï¼š**

1. **ç”¨æˆ·å¯è¯»çš„é›†åˆ**ï¼ˆusers, students, activities, photographers, announcements, bannersï¼‰
   - æ‰€æœ‰ç”¨æˆ·å¯è¯»
   - ä»…åˆ›å»ºè€…æˆ–ç®¡ç†å‘˜å¯å†™

2. **ä»…ç®¡ç†å‘˜çš„é›†åˆ**ï¼ˆadmin_list, activity_categoriesï¼‰
   - ä»…ç®¡ç†å‘˜å¯è¯»å†™

3. **è®¢å•ç±»é›†åˆ**ï¼ˆactivity_orders, archivesï¼‰
   - ä»…åˆ›å»ºè€…å’Œç®¡ç†å‘˜å¯è¯»å†™

---

## ğŸ“ åˆå§‹åŒ–æ•°æ®

åˆ›å»ºé›†åˆåï¼Œå»ºè®®æ·»åŠ ä¸€äº›åˆå§‹æ•°æ®ï¼š

### 1. æ·»åŠ ç¬¬ä¸€ä¸ªç®¡ç†å‘˜

åœ¨ `admin_list` é›†åˆä¸­æ‰‹åŠ¨æ·»åŠ ä¸€æ¡è®°å½•ï¼š

```json
{
  "openid": "æ‚¨çš„å¾®ä¿¡OpenID",
  "name": "ç®¡ç†å‘˜å§“å",
  "phone": "13800138000",
  "permissions": ["all"],
  "isActive": true,
  "createdAt": "2025-10-14T00:00:00.000Z"
}
```

**è·å–OpenIDæ–¹æ³•ï¼š**
1. å…ˆä»¥æ™®é€šç”¨æˆ·ç™»å½•å°ç¨‹åº
2. è¿›å…¥"æˆ‘çš„"é¡µé¢
3. å¤åˆ¶æ˜¾ç¤ºçš„OpenID
4. åœ¨æ•°æ®åº“ä¸­æ·»åŠ è¯¥OpenIDä¸ºç®¡ç†å‘˜

### 2. åˆ›å»ºæ´»åŠ¨åˆ†ç±»

åœ¨ç®¡ç†å‘˜åå° â†’ åˆ†ç±»ç®¡ç† â†’ æ·»åŠ åˆ†ç±»ï¼š

- ğŸ“¸ è¯ä»¶ç…§ï¼ˆæ’åºï¼š0ï¼‰
- ğŸ“ æ¯•ä¸šç…§ï¼ˆæ’åºï¼š1ï¼‰
- ğŸ¨ è‰ºæœ¯ç…§ï¼ˆæ’åºï¼š2ï¼‰
- ğŸ‰ èŠ‚æ—¥æ´»åŠ¨ï¼ˆæ’åºï¼š3ï¼‰

---

## âš¡ ä¸€é”®åˆ›å»ºè„šæœ¬ï¼ˆé«˜çº§ï¼‰

å¦‚æœæ‚¨ç†Ÿæ‚‰äº‘å‡½æ•°ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªåˆå§‹åŒ–äº‘å‡½æ•°ï¼š

```javascript
// äº‘å‡½æ•° initDatabase
const cloud = require('wx-server-sdk')
cloud.init({ env: cloud.DYNAMIC_CURRENT_ENV })
const db = cloud.database()

exports.main = async (event, context) => {
  const collections = [
    'users',
    'admin_list',
    'photographer_accounts',
    'students',
    'archives',
    'activities',
    'activity_categories',
    'activity_orders',
    'photographers',
    'announcements',
    'banners'
  ]
  
  const results = []
  
  for (const name of collections) {
    try {
      await db.createCollection(name)
      results.push({ name, success: true })
    } catch (e) {
      results.push({ name, success: false, error: e.message })
    }
  }
  
  return results
}
```

---

## 8. order_photo_historyï¼ˆè®¢å•ç…§ç‰‡å†å²è®°å½•è¡¨ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨è®¢å•ä¸­è¢«æ‹’ç»çš„ç…§ç‰‡å†å²è®°å½•ï¼Œç”¨äºå®¡æ ¸æ—¶æŸ¥çœ‹ä¿®æ”¹å†ç¨‹

**å­—æ®µç»“æ„**ï¼š
```json
{
  "_id": "ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ",
  "_openid": "ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ",
  "orderId": "è®¢å•IDï¼ˆå…³è”activity_ordersï¼‰",
  "photos": ["ç…§ç‰‡URLæ•°ç»„"],
  "rejectType": "æ‹’ç»ç±»å‹ï¼šadmin-ç®¡ç†å‘˜é©³å›, user-ç”¨æˆ·æ‹’ç»",
  "rejectReason": "æ‹’ç»åŸå› ",
  "rejectCount": 1,
  "rejectedAt": "2025-01-14T12:00:00.000Z",
  "createdAt": "2025-01-14T12:00:00.000Z"
}
```

**ç´¢å¼•å»ºè®®**ï¼š
- `orderId`ï¼ˆå‡åºï¼‰+ `createdAt`ï¼ˆé™åºï¼‰- ç”¨äºæŸ¥è¯¢è®¢å•çš„å†å²è®°å½•å¹¶æŒ‰æ—¶é—´æ’åº

**åˆ›å»ºæ­¥éª¤**ï¼š
1. äº‘å¼€å‘æ§åˆ¶å° â†’ æ•°æ®åº“ â†’ æ·»åŠ é›†åˆ
2. é›†åˆåç§°ï¼š`order_photo_history`
3. æƒé™è®¾ç½®ï¼šæ‰€æœ‰ç”¨æˆ·å¯è¯»ï¼Œä»…åˆ›å»ºè€…å¯è¯»å†™
4. åˆ›å»ºç»„åˆç´¢å¼•ï¼š
   - å­—æ®µ1ï¼š`orderId` å‡åº
   - å­—æ®µ2ï¼š`createdAt` é™åº

**ä½¿ç”¨åœºæ™¯**ï¼š
- ç®¡ç†å‘˜å®¡æ ¸æ—¶æŸ¥çœ‹æ¯æ¬¡æ‹’ç»çš„ç…§ç‰‡
- å¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„ä½œå“è´¨é‡
- è¿½è¸ªä¿®æ”¹è¿›åº¦å’Œå†å²
- ä¸ºäº‰è®®æä¾›è¯æ®

---

## ğŸ¯ æ€»ç»“

1. **å¿…é¡»åˆ›å»º** 13ä¸ªæ•°æ®åº“é›†åˆï¼ˆæ–°å¢ order_photo_historyï¼‰
2. **ç‰¹åˆ«æ³¨æ„** `activity_categories` å’Œ `order_photo_history` æ˜¯æ–°å¢é›†åˆ
3. **è®¾ç½®æƒé™** æ ¹æ®ä¸Šé¢çš„å»ºè®®è®¾ç½®
4. **æ·»åŠ ç®¡ç†å‘˜** æ‰‹åŠ¨æ·»åŠ ç¬¬ä¸€ä¸ªç®¡ç†å‘˜è®°å½•
5. **åˆ›å»ºç´¢å¼•** ç‰¹åˆ«æ˜¯ order_photo_history çš„ç»„åˆç´¢å¼•

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œå°ç¨‹åºå³å¯æ­£å¸¸è¿è¡Œï¼ğŸš€

